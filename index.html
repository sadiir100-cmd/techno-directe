/* ===========================
   PARTIE 2 / 3 - MOTEUR JS
   =========================== */

/* -------- Donn√©es initiales (si localStorage vide) -------- */
const DEFAULT_AFFICHES = [
  { id: genId(), nom: "HP ZBook 14u G6", prix: 60000, desc: "256 SSD ‚Ä¢ 8 Go RAM ‚Ä¢ Batterie >3h ‚Ä¢ Processeur i5", specs: "256 SSD ¬∑ 8 Go ¬∑ i5 ¬∑ Batterie >3h", image: null },
  { id: genId(), nom: "Lenovo ThinkPad T480", prix: 72000, desc: "512 SSD ‚Ä¢ 8 Go ‚Ä¢ Excellente autonomie", specs: "512 SSD ¬∑ 8 Go ¬∑ i5", image: null },
  { id: genId(), nom: "Dell Latitude 3310", prix: 65000, desc: "256 SSD ‚Ä¢ 8 Go ‚Ä¢ Full HD", specs: "256 SSD ¬∑ 8 Go ¬∑ Full HD", image: null },
  { id: genId(), nom: "HP EliteBook 840 G3", prix: 58000, desc: "256 SSD ‚Ä¢ 8 Go ‚Ä¢ L√©ger", specs: "256 SSD ¬∑ 8 Go", image: null },
  { id: genId(), nom: "Lenovo IdeaPad 3", prix: 54000, desc: "128 SSD ‚Ä¢ 4 Go ‚Ä¢ Bon prix", specs: "128 SSD ¬∑ 4 Go", image: null },
];

let affiches   = loadStorage("td_affiches")   || DEFAULT_AFFICHES.slice();
let commandes  = loadStorage("td_commandes")  || [];
let prixParWilaya = loadStorage("td_prix_wilaya") || {}; // { "Alger": {dom:600, bur:470}, ... }
let livraisonGratuite = loadStorage("td_livraison_gratuite") || false;

/* -------- Helper utilitaires -------- */
function genId(){ return 'a'+Math.random().toString(36).slice(2,9) }
function saveStorage(key, val){ localStorage.setItem(key, JSON.stringify(val)) }
function loadStorage(key){ try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : null } catch(e){ return null } }
function numberFormat(n){ return (n||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "); }
function escapeHtml(s){ if(!s) return ""; return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'", "&#39;"); }
function quote(s){ if(s==null) return '""'; return '"' + (""+s).replace(/"/g,'""') + '"' }

/* -------- Catalogue / rendu public -------- */
function renderCatalogue(){
  const root = document.getElementById("catalogue");
  root.innerHTML = "";
  affiches.forEach((pc, idx) => {
    const imgSrc = pc.image || `https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=900&q=60`;
    const livraisonLabel = livraisonGratuite ? `<div style="color:green;font-weight:700;margin-top:6px">üöö Livraison gratuite</div>` : "";
    const html = document.createElement("article");
    html.className = "card";
    html.innerHTML = `
      <div class="media"><img src="${imgSrc}" alt="${escapeHtml(pc.nom)}" loading="lazy"></div>
      <div class="content">
        <h3>${escapeHtml(pc.nom)}</h3>
        <p class="desc">${escapeHtml(pc.desc)}</p>
        <p class="spec">${escapeHtml(pc.specs || '')}</p>
        <div class="price">${numberFormat(pc.prix)} DA</div>
      </div>
      <div class="actions">
        <button class="btn-commande" onclick="openCommandeModal('${pc.id}')">Commander ici</button>
        <button class="btn-whatsapp" onclick="openWhatsApp('${encodeURIComponent(pc.nom)}')">WhatsApp</button>
      </div>
    `;
    root.appendChild(html);
  });
}

/* -------- Commande modal (public) -------- */
let currentProduitId = null;
function openCommandeModal(produitId){
  currentProduitId = produitId;
  const pc = affiches.find(a=>a.id===produitId);
  document.getElementById("modalProduitNom").innerText = pc ? pc.nom : "";
  fillWilayaSelect("cmd_wilaya");
  document.getElementById("overlayCommande").style.display = "flex";
}
function closeCommande(){
  document.getElementById("overlayCommande").style.display = "none";
  ["cmd_nom","cmd_tel","cmd_tel2"].forEach(id=>document.getElementById(id).value="");
}
function openWhatsApp(nomEncoded){
  window.open(`https://wa.me/213699039372?text=Salam%20je%20veux%20commander%20${nomEncoded}%20sur%20Techno%20Direct`, "_blank");
}

/* -------- Wilaya + prix livraison -------- */
const WILAYAS = [
  "Adrar","Chlef","Laghouat","Oum El Bouaghi","Batna","B√©ja√Øa","Biskra","B√©char","Blida","Bouira",
  "Tamanrasset","T√©bessa","Tlemcen","Tiaret","Tizi Ouzou","Alger","Djelfa","Jijel","S√©tif","Sa√Øda",
  "Skikda","Sidi Bel Abb√®s","Annaba","Guelma","Constantine","M√©d√©a","Mostaganem","M'Sila","Mascara",
  "Ouargla","Oran","El Bayadh","Illizi","Bordj Bou Arreridj","Boumerd√®s","El Tarf","Tindouf","Tissemsilt",
  "El Oued","Khenchela","Souk Ahras","Tipaza","Mila","A√Øn Defla","Na√¢ma","A√Øn T√©mouchent","Gharda√Øa","Relizane",
  "Timimoun","Bordj Badji Mokhtar","Ouled Djellal","B√©ni Abb√®s","In Salah","In Guezzam","Touggourt","Djanet","M'Ghair","El Menia"
];

/* Table des prix : [domicile, bureau]  0 = non disponible */
const PRIX_LIVRAISON = {
  "Adrar": [1400,970], "Chlef": [800,520], "Laghouat": [950,620], "Oum El Bouaghi": [800,520], "Batna": [800,520],
  "B√©ja√Øa": [500,520], "Biskra": [950,620], "B√©char": [1100,720], "Blida": [750,470], "Bouira": [700,520],
  "Tamanrasset": [1600,1120], "T√©bessa": [800,520], "Tlemcen": [900,570], "Tiaret": [800,520], "Tizi Ouzou": [650,520],
  "Alger": [600,470], "Djelfa": [950,620], "Jijel": [700,520], "S√©tif": [750,520], "Sa√Øda": [800,570],
  "Skikda": [750,520], "Sidi Bel Abb√®s": [750,520], "Annaba": [800,520], "Guelma": [800,520], "Constantine": [750,520],
  "M√©d√©a": [750,520], "Mostaganem": [750,520], "M'Sila": [850,570], "Mascara": [750,520], "Ouargla": [1000,670],
  "Oran": [700,520], "El Bayadh": [1050,670], "Illizi": [0,0], "Bordj Bou Arreridj": [750,520], "Boumerd√®s": [750,520],
  "El Tarf": [850,520], "Tindouf": [0,0], "Tissemsilt": [800,520], "El Oued": [1000,670], "Khenchela": [800,0],
  "Souk Ahras": [800,520], "Tipaza": [750,520], "Mila": [750,520], "A√Øn Defla": [750,520], "Na√¢ma": [1100,670],
  "A√Øn T√©mouchent": [750,520], "Gharda√Øa": [1000,620], "Relizane": [750,520], "Timimoun": [1400,970],
  "Bordj Badji Mokhtar": [0,0], "Ouled Djellal": [950,620], "B√©ni Abb√®s": [1000,970], "In Salah": [1600,0],
  "In Guezzam": [1600,0], "Touggourt": [1000,670], "Djanet": [0,0], "M'Ghair": [1000,0], "El Menia": [1000,0]
};

/* init prixParWilaya si vide */
if(Object.keys(prixParWilaya).length === 0){
  WILAYAS.forEach(w=> prixParWilaya[w] = { dom: PRIX_LIVRAISON[w][0], bur: PRIX_LIVRAISON[w][1] });
}

function submitCommande(){
  const nom   = document.getElementById("cmd_nom").value.trim();
  const tel   = document.getElementById("cmd_tel").value.trim();
  const tel2  = document.getElementById("cmd_tel2").value.trim();
  const wilaya= document.getElementById("cmd_wilaya").value;
  const type  = document.getElementById("cmd_type").value;
  if(!nom || !tel || !wilaya){ alert("Remplis les champs obligatoires (nom, t√©l√©phone, wilaya)."); return; }
  const produit = affiches.find(a=>a.id===currentProduitId);
  if(!produit){ alert("Produit introuvable."); closeCommande(); return; }

  const prixLivObj = prixParWilaya[wilaya] || {dom:800,bur:520};
  let prixLiv = 0;
  if(type==="Domicile"){
    if(prixLivObj.dom === 0){ alert("Livraison √† domicile non disponible pour cette wilaya."); return; }
    prixLiv = prixLivObj.dom;
  } else {
    if(prixLivObj.bur === 0){ alert("R√©cup√©ration au bureau non disponible pour cette wilaya."); return; }
    prixLiv = prixLivObj.bur;
  }
  if(livraisonGratuite) prixLiv = 0;

  const total = produit.prix + prixLiv;
  const cmd = { id: genId(), produit: produit.nom, produitId: produit.id, nom, tel, tel2, wilaya, type, prixProduit: produit.prix, prixLivraison: prixLiv, total, date: new Date().toISOString() };
  commandes.push(cmd);
  saveStorage("td_commandes", commandes);
  renderAdminCommandsTable();
  closeCommande();
  alert("‚úÖ Commande enregistr√©e ‚Äî tu peux la voir dans la zone admin.");
}

/* -------- Admin : ouvrir √©dition rapide d'une affiche (depuis public) -------- */
function openAdminEdit(afficheId){
  const pwd = prompt("Mot de passe admin requis pour √©diter (technoid) :");
  if(pwd !== "technoid"){ alert("Mot de passe incorrect."); return; }
  openAdminFull();
  setTimeout(()=>{
    const idx = affiches.findIndex(a=>a.id===afficheId);
    if(idx === -1) return;
    populateEditForm(idx);
    document.getElementById("adminLeftColumn").scrollIntoView({behavior:"smooth"});
  }, 120);
}

/* -------- ADMIN : UI injection & gestion (left & right columns) -------- */
function openAdminFull(){
  document.getElementById("adminPanelFull").style.display = "block";
  document.getElementById("adminPanelFull").setAttribute("aria-hidden","false");
  buildAdminUI();
}
function closeAdminFull(){
  document.getElementById("adminPanelFull").style.display = "none";
  document.getElementById("adminPanelFull").setAttribute("aria-hidden","true");
  saveAll();
}

/* Build admin content */
function buildAdminUI(){
  const left = document.getElementById("adminLeftColumn");
  const right = document.getElementById("adminRightColumn");
  left.innerHTML = "";
  right.innerHTML = "";

  // LEFT: Form ajout / √©dition + liste affiches
  left.innerHTML = `
    <section style="background:#071022;padding:12px;border-radius:8px;margin-bottom:12px">
      <h3 style="margin:0 0 8px;color:var(--orange)">Ajouter / Modifier une affiche</h3>
      <div style="display:grid;gap:8px">
        <input id="admin_nom" type="text" placeholder="Nom du PC" />
        <input id="admin_prix" type="number" placeholder="Prix (DA)" />
        <input id="admin_specs" type="text" placeholder="Sp√©cifications courtes (ex: 256 SSD ¬∑ 8 Go)" />
        <textarea id="admin_desc" placeholder="Description d√©taill√©e"></textarea>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="admin_image_file" type="file" accept="image/*" />
          <button class="smallbtn" onclick="pickImageFile()">T√©l√©charger</button>
          <button class="smallbtn" onclick="clearImagePreview()">Supprimer image</button>
        </div>
        <div id="admin_image_preview" style="margin-top:6px"></div>
        <div style="display:flex;gap:8px">
          <button class="btn-save" onclick="saveAffiche()">üíæ Sauvegarder</button>
          <button class="btn-cancel" onclick="clearAdminForm()">Annuler</button>
        </div>
      </div>
    </section>

    <section style="background:#071022;padding:12px;border-radius:8px">
      <h3 style="margin:0 0 8px;color:var(--orange)">Affiches publi√©es (<span id="countAffiches">${affiches.length}</span>/20)</h3>
      <div id="admin_list_affiches" style="display:flex;flex-direction:column;gap:8px;max-height:360px;overflow:auto"></div>
    </section>
  `;

  // RIGHT: commandes + prix wilaya + options
  right.innerHTML = `
    <section style="margin-bottom:12px">
      <h3 style="color:var(--orange)">Commandes re√ßues (${commandes.length})</h3>
      <div style="max-height:260px;overflow:auto;background:#081224;padding:8px;border-radius:8px">
        <table id="admin_table_commandes" style="width:100%"></table>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="smallbtn" onclick="exportCommandes()">Exporter CSV</button>
        <button class="smallbtn" onclick="confirmDeleteAllCommands()">Supprimer tout</button>
      </div>
    </section>

    <section style="margin-top:12px;background:#071022;padding:10px;border-radius:8px">
      <h3 style="color:var(--orange)">Prix livraison par wilaya</h3>
      <div id="admin_prix_wilaya" style="max-height:260px;overflow:auto;padding-top:8px"></div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn-save" onclick="savePrixWilaya()">üíæ Sauvegarder prix</button>
        <button class="btn-cancel" onclick="resetPrixParDefaut()">R√©initialiser d√©faut</button>
      </div>
    </section>

    <section style="margin-top:12px;background:#071022;padding:10px;border-radius:8px">
      <h3 style="color:var(--orange)">Options</h3>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn-save" onclick="toggleLivraisonGratuiteAdmin()">${livraisonGratuite ? 'D√©sactiver livraison gratuite' : 'Activer livraison gratuite'}</button>
        <button class="btn-cancel" onclick="saveAll()">Sauvegarder tout</button>
      </div>
    </section>
  `;

  // fill lists and tables
  renderAdminAffichesList();
  renderAdminCommandsTable();
  renderAdminPrixWilaya();
}

/* Admin: render list of affiches with edit/delete and image preview */
function renderAdminAffichesList(){
  const cont = document.getElementById("admin_list_affiches");
  cont.innerHTML = "";
  affiches.forEach((a, idx) => {
    const div = document.createElement("div");
    div.style.display = "flex"; div.style.alignItems = "center"; div.style.justifyContent = "space-between"; div.style.gap = "8px";
    div.style.background = "#0b1a2a"; div.style.padding = "8px"; div.style.borderRadius = "8px";
    div.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <div style="width:64px;height:48px;background:#001526;border-radius:6px;overflow:hidden">
          <img src="${a.image || 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=60'}" style="width:100%;height:100%;object-fit:cover" />
        </div>
        <div>
          <div style="font-weight:700;color:var(--orange)">${escapeHtml(a.nom)}</div>
          <div style="font-size:12px;color:#cfe6ff">${numberFormat(a.prix)} DA</div>
        </div>
      </div>
      <div>
        <button class="smallbtn" onclick="populateEditForm(${idx})">Modifier</button>
        <button class="smallbtn" onclick="moveAfficheUp(${idx})">‚Üë</button>
        <button class="smallbtn" onclick="moveAfficheDown(${idx})">‚Üì</button>
        <button class="smallbtn" onclick="deleteAffiche(${idx})" style="background:#ef4444">Suppr</button>
      </div>
    `;
    cont.appendChild(div);
  });
  document.getElementById("countAffiches").innerText = affiches.length;
}

/* Admin: populate edit form with existing affiche at index */
let editingIndex = -1;
function populateEditForm(index){
  editingIndex = index;
  const a = affiches[index];
  document.getElementById("admin_nom").value = a.nom || "";
  document.getElementById("admin_prix").value = a.prix || "";
  document.getElementById("admin_specs").value = a.specs || "";
  document.getElementById("admin_desc").value = a.desc || "";
  // preview image
  const prev = document.getElementById("admin_image_preview");
  prev.innerHTML = a.image ? `<div style="max-height:120px;overflow:hidden;border-radius:6px"><img src="${a.image}" style="width:100%;height:auto"></div>` : `<div style="color:#999">Pas d'image</div>`;
}

/* Admin: clear form to add new */
function clearAdminForm(){
  editingIndex = -1;
  document.getElementById("admin_nom").value = "";
  document.getElementById("admin_prix").value = "";
  document.getElementById("admin_specs").value = "";
  document.getElementById("admin_desc").value = "";
  document.getElementById("admin_image_preview").innerHTML = "";
  document.getElementById("admin_image_file").value = "";
}

/* Admin: save affiche (new or edit) */
function saveAffiche(){
  const nom   = document.getElementById("admin_nom").value.trim();
  const prix  = parseInt(document.getElementById("admin_prix").value);
  const specs = document.getElementById("admin_specs").value.trim();
  const desc  = document.getElementById("admin_desc").value.trim();
  const previewDiv = document.getElementById("admin_image_preview");
  const imgTag = previewDiv.querySelector("img");
  const imageData = imgTag ? imgTag.src : null;

  if(!nom || !prix || !desc){ alert("Nom, prix et description obligatoires."); return; }
  if(editingIndex >= 0){
    // update
    affiches[editingIndex].nom   = nom;
    affiches[editingIndex].prix  = prix;
    affiches[editingIndex].specs = specs;
    affiches[editingIndex].desc  = desc;
    affiches[editingIndex].image = imageData;
    alert("‚úÖ Affiche modifi√©e.");
  } else {
    // add new (limit 20)
    if(affiches.length >= 20){ alert("Limite atteinte : max 20 affiches."); return; }
    affiches.push({ id: genId(), nom, prix, specs, desc, image: imageData });
    alert("‚úÖ Nouvelle affiche ajout√©e.");
  }
  // reset and render
  saveAll();
  clearAdminForm();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Admin: delete affiche */
function deleteAffiche(index){
  if(!confirm("Supprimer cette affiche ?")) return;
  affiches.splice(index,1);
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Admin: move affiche up/down */
function moveAfficheUp(index){
  if(index <= 0) return;
  const temp = affiches[index-1];
  affiches[index-1] = affiches[index];
  affiches[index] = temp;
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}
function moveAfficheDown(index){
  if(index >= affiches.length-1) return;
  const temp = affiches[index+1];
  affiches[index+1] = affiches[index];
  affiches[index] = temp;
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Image upload: pick file input and convert to base64 preview */
function pickImageFile(){
  const input = document.getElementById("admin_image_file");
  input.click();
  input.onchange = function(e){
    const file = e.target.files[0];
    if(!file) return;
    if(file.size > 4_500_000){ alert("Image trop lourde (max ~4.5MB)."); input.value = ""; return; }
    const reader = new FileReader();
    reader.onload = function(evt){
      const src = evt.target.result;
      document.getElementById("admin_image_preview").innerHTML = `<div style="max-height:160px;overflow:hidden;border-radius:8px"><img src="${src}" style="width:100%;height:auto"></div>`;
    };
    reader.readAsDataURL(file);
  };
}
function clearImagePreview(){
  document.getElementById("admin_image_preview").innerHTML = "";
  document.getElementById("admin_image_file").value = "";
}

/* -------- Admin: commandes table -------- */
function renderAdminCommandsTable(){
  const table = document.getElementById("admin_table_commandes");
  if(!table) return;
  if(commandes.length === 0){ table.innerHTML = "<tr><td>Aucune commande</td></tr>"; return; }
  let html = "<tr><th>Produit</th><th>Nom</th><th>T√©l</th><th>Wilaya</th><th>Type</th><th>Total</th><th>Actions</th></tr>";
  commandes.forEach((c, i) => {
    html += `<tr>
      <td>${escapeHtml(c.produit)}</td>
      <td>${escapeHtml(c.nom)}</td>
      <td>${escapeHtml(c.tel)}${c.tel2 ? " / "+escapeHtml(c.tel2) : ""}</td>
      <td>${escapeHtml(c.wilaya)}</td>
      <td>${escapeHtml(c.type)}</td>
      <td>${numberFormat(c.total)} DA</td>
      <td>
        <button class="smallbtn" onclick="openCommandWhatsApp('${i}')">WhatsApp</button>
        <button class="smallbtn" onclick="deleteCommand(${i})" style="background:#ef4444">Suppr</button>
      </td>
    </tr>`;
  });
  table.innerHTML = html;
}
function openCommandWhatsApp(index){
  const c = commandes[index];
  if(!c) return;
  const msg = encodeURIComponent(`Salam, commande: ${c.produit}\nNom: ${c.nom}\nT√©l: ${c.tel}${c.tel2 ? ' / '+c.tel2 : ''}\nWilaya: ${022;padding:10px;border-radius:8px">
      <h3 style="color:var(--orange)">Options</h3>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn-save" onclick="toggleLivraisonGratuiteAdmin()">${livraisonGratuite ? 'D√©sactiver livraison gratuite' : 'Activer livraison gratuite'}</button>
        <button class="btn-cancel" onclick="saveAll()">Sauvegarder tout</button>
      </div>
    </section>
  `;

  // fill lists and tables
  renderAdminAffichesList();
  renderAdminCommandsTable();
  renderAdminPrixWilaya();
}

/* Admin: render list of affiches with edit/delete and image preview */
function renderAdminAffichesList(){
  const cont = document.getElementById("admin_list_affiches");
  cont.innerHTML = "";
  affiches.forEach((a, idx) => {
    const div = document.createElement("div");
    div.style.display = "flex";
    div.style.alignItems = "center";
    div.style.justifyContent = "space-between";
    div.style.gap = "8px";
    div.style.background = "#0b1a2a";
    div.style.padding = "8px";
    div.style.borderRadius = "8px";
    div.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <div style="width:64px;height:48px;background:#001526;border-radius:6px;overflow:hidden">
          <img src="${a.image || 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=60'}" style="width:100%;height:100%;object-fit:cover" />
        </div>
        <div>
          <div style="font-weight:700;color:var(--orange)">${escapeHtml(a.nom)}</div>
          <div style="font-size:12px;color:#cfe6ff">${numberFormat(a.prix)} DA</div>
        </div>
      </div>
      <div>
        <button class="smallbtn" onclick="populateEditForm(${idx})">Modifier</button>
        <button class="smallbtn" onclick="moveAfficheUp(${idx})">‚Üë</button>
        <button class="smallbtn" onclick="moveAfficheDown(${idx})">‚Üì</button>
        <button class="smallbtn" onclick="deleteAffiche(${idx})" style="background:#ef4444">Suppr</button>
      </div>
    `;
    cont.appendChild(div);
  });
  document.getElementById("countAffiches").innerText = affiches.length;
}

/* Admin: populate edit form with existing affiche at index */
let editingIndex = -1;
function populateEditForm(index){
  editingIndex = index;
  const a = affiches[index];
  document.getElementById("admin_nom").value = a.nom || "";
  document.getElementById("admin_prix").value = a.prix || "";
  document.getElementById("admin_specs").value = a.specs || "";
  document.getElementById("admin_desc").value = a.desc || "";
  // preview image
  const prev = document.getElementById("admin_image_preview");
  prev.innerHTML = a.image ? `<div style="max-height:120px;overflow:hidden;border-radius:6px"><img src="${a.image}" style="width:100%;height:auto"></div>` : `<div style="color:#999">Pas d'image</div>`;
}

/* Admin: clear form to add new */
function clearAdminForm(){
  editingIndex = -1;
  document.getElementById("admin_nom").value = "";
  document.getElementById("admin_prix").value = "";
  document.getElementById("admin_specs").value = "";
  document.getElementById("admin_desc").value = "";
  document.getElementById("admin_image_preview").innerHTML = "";
  document.getElementById("admin_image_file").value = "";
}

/* Admin: save affiche (new or edit) */
function saveAffiche(){
  const nom = document.getElementById("admin_nom").value.trim();
  const prix = parseInt(document.getElementById("admin_prix").value);
  const specs = document.getElementById("admin_specs").value.trim();
  const desc = document.getElementById("admin_desc").value.trim();
  const previewDiv = document.getElementById("admin_image_preview");
  const imgTag = previewDiv.querySelector("img");
  const imageData = imgTag ? imgTag.src : null;

  if(!nom || !prix || !desc){ alert("Nom, prix et description obligatoires."); return; }
  if(editingIndex >= 0){
    // update
    affiches[editingIndex].nom = nom;
    affiches[editingIndex].prix = prix;
    affiches[editingIndex].specs = specs;
    affiches[editingIndex].desc = desc;
    affiches[editingIndex].image = imageData;
    alert("‚úÖ Affiche modifi√©e.");
  } else {
    // add new (limit 20)
    if(affiches.length >= 20){ alert("Limite atteinte : max 20 affiches."); return; }
    affiches.push({ id: genId(), nom, prix, specs, desc, image: imageData });
    alert("‚úÖ Nouvelle affiche ajout√©e.");
  }
  // reset and render
  saveAll();
  clearAdminForm();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Admin: delete affiche */
function deleteAffiche(index){
  if(!confirm("Supprimer cette affiche ?")) return;
  affiches.splice(index,1);
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Admin: move affiche up/down */
function moveAfficheUp(index){
  if(index <= 0) return;
  const temp = affiches[index-1];
  affiches[index-1] = affiches[index];
  affiches[index] = temp;
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}
function moveAfficheDown(index){
  if(index >= affiches.length-1) return;
  const temp = affiches[index+1];
  affiches[index+1] = affiches[index];
  affiches[index] = temp;
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Image upload: pick file input and convert to base64 preview */
function pickImageFile(){
  const input = document.getElementById("admin_image_file");
  input.click();
  input.onchange = function(e){
    const file = e.target.files[0];
    if(!file) return;
    if(file.size > 4_500_000){
      alert("Image trop lourde (max ~4.5MB).");
      input.value = "";
      return;
    }
    const reader = new FileReader();
    reader.onload = function(evt){
      const src = evt.target.result;
      document.getElementById("admin_image_preview").innerHTML = `<div style="max-height:160px;overflow:hidden;border-radius:8px"><img src="${src}" style="width:100%;height:auto"></div>`;
    };
    reader.readAsDataURL(file);
  };
}
function clearImagePreview(){
  document.getElementById("admin_image_preview").innerHTML = "";
  document.getElementById("admin_image_file").value = "";
}

/* -------- Admin: commandes table -------- */
function renderAdminCommandsTable(){
  const table = document.getElementById("admin_table_commandes");
  if(!table) return;
  if(commandes.length === 0){ table.innerHTML = "<tr><td>Aucune commande</td></tr>"; return; }
  let html = "<tr><th>Produit</th><th>Nom</th><th>T√©l</th><th>Wilaya</th><th>Type</th><th>Total</th><th>Actions</th></tr>";
  commandes.forEach((c, i) => {
    html += `<tr>
      <td>${escapeHtml(c.produit)}</td>
      <td>${escapeHtml(c.nom)}</td>
      <td>${escapeHtml(c.tel)}${c.tel2 ? " / "+escapeHtml(c.tel2) : ""}</td>
      <td>${escapeHtml(c.wilaya)}</td>
      <td>${escapeHtml(c.type)}</td>
      <td>${numberFormat(c.total)} DA</td>
      <td>
        <button class="smallbtn" onclick="openCommandWhatsApp('${i}')">WhatsApp</button>
        <button class="smallbtn" onclick="deleteCommand(${i})" style="background:#ef4444">Suppr</button>
      </td>
    </tr>`;
  });
  table.innerHTML = html;
}
function openCommandWhatsApp(index){
  const c = commandes[index];
  if(!c) return;
  const msg = encodeURIComponent(`Salam, commande: ${c.produit}\nNom: ${c.nom}\nT√©l: ${c.tel}${c.tel2 ? ' / '+c.tel2 : ''}\nWilaya: ${c.wilaya}\nType: ${c.type}\nTotal: ${c.total} DA`);
  window.open(`https://wa.me/213699039372?text=${msg}`, "_blank");
}
function deleteCommand(index){
  if(!confirm("Supprimer cette commande ?")) return;
  commandes.splice(index,1);
  saveAll();
  renderAdminCommandsTable();
}
function confirmDeleteAllCommands(){
  if(!confirm("Supprimer toutes les commandes ?")) return;
  commandes = [];
  saveAll();
  renderAdminCommandsTable();
}
function exportCommandes(){
  if(commandes.length === 0){ alert("Aucune commande √† exporter."); return; }
  const csv = [
    ["id","produit","nom","tel","tel2","wilaya","type","prixProduit","prixLivraison","total","date"].join(","),
    ...commandes.map(c => [c.id, quote(c.produit), quote(c.nom), quote(c.tel), quote(c.tel2||""), quote(c.wilaya), quote(c.type), c.prixProduit, c.prixLivraison, c.total, c.date].join(","))
  ].join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "commandes_techno_direct.csv"; document.body.appendChild(a); a.click(); a.remove();
}

/* -------- Admin: prix par wilaya -------- */
function renderAdminPrixWilaya(){
  const root = document.getElementById("admin_prix_wilaya");
  root.innerHTML = "";
  WILAYAS.forEach(w => {
    const val = prixParWilaya[w] || {dom:800,bur:520};
    const row = document.createElement("div");
    row.style.display = "flex"; row.style.justifyContent="space-between"; row.style.alignItems="center";
    row.style.padding = "6px 0";
    row.innerHTML = `<div style="width:60%">${w}</div><div style="width:38%"><label style="font-size:11px">Dom</label><input type="number" value="${val.dom}" onchange="prixParWilaya['${w}'].dom=parseInt(this.value)"> <label style="font-size:11px">Bur</label><input type="number" value="${val.bur}" onchange="prixParWilaya['${w}'].bur=parseInt(this.value)"></div>`;
    root.appendChild(row);
  });
}
function savePrixWilaya(){ saveAll(); alert("‚úÖ Prix de livraison sauvegard√©s."); }
function resetPrixParDefaut(){ if(confirm("R√©initialiser tous les prix ?")){ prixParWilaya = {}; WILAYAS.forEach(w=> prixParWilaya[w] = {dom:800,bur:520}); saveAll(); renderAdminPrixWilaya(); alert("R√©initialis√©."); } }

/* -------- Admin: livraison gratuite toggle -------- */
function toggleLivraisonGratuiteAdmin(){
  livraisonGratuite = !livraisonGratuite;
  saveAll();
  buildAdminUI();
  renderCatalogue();
  alert(livraisonGratuite ? "Livraison gratuite activ√©e." : "Livraison gratuite d√©sactiv√©e.");
}

/* -------- Save / load all -------- */
function saveAll(){
  saveStorage("td_affiches", affiches);
  saveStorage("td_commandes", commandes);
  saveStorage("td_prix_wilaya", prixParWilaya);
  saveStorage("td_livraison_gratuite", livraisonGratuite);
}

/* -------- Utilities: fill wilaya select for public modal -------- */
function fillWilayaSelect(selectId){
  const sel = document.getElementById(selectId);
  if(!sel) return;
  if(sel.dataset.filled) return;
  sel.innerHTML = '<option value="">Choisir une wilaya</option>';
  WILAYAS.forEach(w => {
    sel.innerHTML += `<option value="${w}">${w}</option>`;
  });
  sel.dataset.filled = "1";
}

/* -------- Escape helper to prevent injection in HTML strings -------- */
function escapeHtml(s){ if(!s) return ""; return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'", "&#39;"); }
function quote(s){ if(s==null) return '""'; return '"' + (""+s).replace(/"/g,'""') + '"' }

/* -------- Init on load -------- */
window.addEventListener("load", ()=>{
  fillWilayaSelect("cmd_wilaya");
  renderCatalogue();
});

/* expose some functions to global scope for buttons */
window.openCommandeModal = openCommandeModal;
window.closeCommande = closeCommande;
window.submitCommande = submitCommande;
window.openWhatsApp = openWhatsApp;
window.loginAdmin = function(){
  const pwd = prompt("Mot de passe :");
  if(pwd === "technoid"){ openAdminFull(); } else { alert("Mot de passe incorrect"); }
};
window.openAdminEdit = openAdminEdit;
window.saveAll = saveAll;
window.renderCatalogue = renderCatalogue;
window.renderAdminCommandsTable = renderAdminCommandsTable;
window.populateEditForm = populateEditForm;
window.saveAffiche = saveAffiche;
window.deleteAffiche = deleteAffiche;
window.pickImageFile = pickImageFile;
window.clearImagePreview = clearImagePreview;
window.moveAfficheUp = moveAfficheUp;
window.moveAfficheDown = moveAfficheDown;
window.savePrixWilaya = savePrixWilaya;
window.toggleLivraisonGratuiteAdmin = toggleLivraisonGratuiteAdmin;
window.exportCommandes = exportCommandes;
window.deleteCommand = deleteCommand;
window.confirmDeleteAllCommands = confirmDeleteAllCommands;
</script>

<!-- === SECTION ADMIN (suite) === -->
<section id="adminZone" class="admin-zone" style="display:none;">
  <h2>Zone Administrative</h2>
  
  <!-- === GESTION AFFICHES === -->
  <div class="admin-section">
    <h3>üñºÔ∏è G√©rer les Affiches Publicitaires</h3>
    <form id="newAdForm">
      <input type="text" id="newAdTitle" placeholder="Nom du produit" required>
      <input type="number" id="newAdPrice" placeholder="Prix (en DA)" required>
      <textarea id="newAdDesc" placeholder="Description du produit (ex: 256 SSD, 8 GigaOKT, processeur i5...)"></textarea>
      <input type="file" id="newAdImage" accept="image/*" required>
      <button type="submit">Ajouter une Affiche</button>
    </form>
    
    <div id="adsList" class="ads-list"></div>
  </div>

  <!-- === GESTION DES LIVRAISONS === -->
  <div class="admin-section">
    <h3>üöö Prix de Livraison par Wilaya</h3>
    <div id="livraisonContainer"></div>
    <button id="saveLivraison">üíæ Sauvegarder les prix</button>
    <button id="toggleFreeDelivery">üü¢ Livraison Gratuite (activer / d√©sactiver)</button>
  </div>

  <!-- === GESTION DES COMMANDES === -->
  <div class="admin-section">
    <h3>üì¶ Liste des Commandes</h3>
    <button id="deleteAllOrders">üóëÔ∏è Supprimer toutes les commandes</button>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>Nom</th>
          <th>T√©l√©phone</th>
          <th>Wilaya</th>
          <th>Livraison</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<style>
  .admin-zone {
    padding: 20px;
    background: #fff;
    font-family: 'Cairo', sans-serif;
  }
  .admin-section {
    margin-bottom: 40px;
    border: 2px solid #ff6b00;
    padding: 15px;
    border-radius: 8px;
  }
  .ads-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  .ad-item {
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 10px;
    text-align: center;
  }
  .ad-item img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-radius: 8px;
  }
  .ad-item input, .ad-item textarea {
    width: 100%;
    margin-top: 5px;
    padding: 5px;
  }
  .ad-item button {
    background-color: #022;padding:10px;border-radius:8px">
      <h3 style="color:var(--orange)">Options</h3>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn-save" onclick="toggleLivraisonGratuiteAdmin()">${livraisonGratuite ? 'D√©sactiver livraison gratuite' : 'Activer livraison gratuite'}</button>
        <button class="btn-cancel" onclick="saveAll()">Sauvegarder tout</button>
      </div>
    </section>
  `;

  renderAdminAffichesList();
  renderAdminCommandsTable();
  renderAdminPrixWilaya();
}

/* Admin: render list of affiches with edit/delete and image preview */
function renderAdminAffichesList(){
  const cont = document.getElementById("admin_list_affiches");
  cont.innerHTML = "";
  affiches.forEach((a, idx) => {
    const div = document.createElement("div");
    div.style.display = "flex";
    div.style.alignItems = "center";
    div.style.justifyContent = "space-between";
    div.style.gap = "8px";
    div.style.background = "#0b1a2a";
    div.style.padding = "8px";
    div.style.borderRadius = "8px";
    div.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <div style="width:64px;height:48px;background:#001526;border-radius:6px;overflow:hidden">
          <img src="${a.image || 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=60'}" style="width:100%;height:100%;object-fit:cover" />
        </div>
        <div>
          <div style="font-weight:700;color:var(--orange)">${escapeHtml(a.nom)}</div>
          <div style="font-size:12px;color:#cfe6ff">${numberFormat(a.prix)} DA</div>
        </div>
      </div>
      <div>
        <button class="smallbtn" onclick="populateEditForm(${idx})">Modifier</button>
        <button class="smallbtn" onclick="moveAfficheUp(${idx})">‚Üë</button>
        <button class="smallbtn" onclick="moveAfficheDown(${idx})">‚Üì</button>
        <button class="smallbtn" onclick="deleteAffiche(${idx})" style="background:#ef4444">Suppr</button>
      </div>
    `;
    cont.appendChild(div);
  });
  document.getElementById("countAffiches").innerText = affiches.length;
}

/* Admin: populate edit form with existing affiche at index */
let editingIndex = -1;
function populateEditForm(index){
  editingIndex = index;
  const a = affiches[index];
  document.getElementById("admin_nom").value = a.nom || "";
  document.getElementById("admin_prix").value = a.prix || "";
  document.getElementById("admin_specs").value = a.specs || "";
  document.getElementById("admin_desc").value = a.desc || "";
  const prev = document.getElementById("admin_image_preview");
  prev.innerHTML = a.image ? `<div style="max-height:120px;overflow:hidden;border-radius:6px"><img src="${a.image}" style="width:100%;height:auto"></div>` : `<div style="color:#999">Pas d'image</div>`;
}

/* Admin: clear form to add new */
function clearAdminForm(){
  editingIndex = -1;
  document.getElementById("admin_nom").value = "";
  document.getElementById("admin_prix").value = "";
  document.getElementById("admin_specs").value = "";
  document.getElementById("admin_desc").value = "";
  document.getElementById("admin_image_preview").innerHTML = "";
  document.getElementById("admin_image_file").value = "";
}

/* Admin: save affiche (new or edit) */
function saveAffiche(){
  const nom   = document.getElementById("admin_nom").value.trim();
  const prix  = parseInt(document.getElementById("admin_prix").value);
  const specs = document.getElementById("admin_specs").value.trim();
  const desc  = document.getElementById("admin_desc").value.trim();
  const imgTag= document.getElementById("admin_image_preview").querySelector("img");
  const imageData = imgTag ? imgTag.src : null;

  if(!nom || !prix || !desc){ alert("Nom, prix et description obligatoires."); return; }
  if(editingIndex >= 0){
    // update
    affiches[editingIndex].nom   = nom;
    affiches[editingIndex].prix  = prix;
    affiches[editingIndex].specs = specs;
    affiches[editingIndex].desc  = desc;
    affiches[editingIndex].image = imageData;
    alert("‚úÖ Affiche modifi√©e.");
  } else {
    if(affiches.length >= 20){ alert("Limite atteinte : max 20 affiches."); return; }
    affiches.push({ id: genId(), nom, prix, specs, desc, image: imageData });
    alert("‚úÖ Nouvelle affiche ajout√©e.");
  }
  saveAll();
  clearAdminForm();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Admin: delete affiche */
function deleteAffiche(index){
  if(!confirm("Supprimer cette affiche ?")) return;
  affiches.splice(index,1);
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Admin: move affiche up/down */
function moveAfficheUp(index){
  if(index <= 0) return;
  const temp = affiches[index-1];
  affiches[index-1] = affiches[index];
  affiches[index] = temp;
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}
function moveAfficheDown(index){
  if(index >= affiches.length-1) return;
  const temp = affiches[index+1];
  affiches[index+1] = affiches[index];
  affiches[index] = temp;
  saveAll();
  renderAdminAffichesList();
  renderCatalogue();
}

/* Image upload: pick file input and convert to base64 preview */
function pickImageFile(){
  const input = document.getElementById("admin_image_file");
  input.click();
  input.onchange = function(e){
    const file = e.target.files[0];
    if(!file) return;
    if(file.size > 4_500_000){ alert("Image trop lourde (max ~4.5MB)."); input.value = ""; return; }
    const reader = new FileReader();
    reader.onload = function(evt){
      const src = evt.target.result;
      document.getElementById("admin_image_preview").innerHTML = `<div style="max-height:160px;overflow:hidden;border-radius:8px"><img src="${src}" style="width:100%;height:auto"></div>`;
    };
    reader.readAsDataURL(file);
  };
}
function clearImagePreview(){
  document.getElementById("admin_image_preview").innerHTML = "";
  document.getElementById("admin_image_file").value = "";
}

/* -------- Admin: commandes table -------- */
function renderAdminCommandsTable(){
  const table = document.getElementById("admin_table_commandes");
  if(!table) return;
  if(commandes.length === 0){ table.innerHTML = "<tr><td>Aucune commande</td></tr>"; return; }
  let html = "<tr><th>Produit</th><th>Nom</th><th>T√©l</th><th>Wilaya</th><th>Type</th><th>Total</th><th>Actions</th></tr>";
  commandes.forEach((c, i) => {
    html += `<tr>
      <td>${escapeHtml(c.produit)}</td>
      <td>${escapeHtml(c.nom)}</td>
      <td>${escapeHtml(c.tel)}${c.tel2 ? " / "+escapeHtml(c.tel2) : ""}</td>
      <td>${escapeHtml(c.wilaya)}</td>
      <td>${escapeHtml(c.type)}</td>
      <td>${numberFormat(c.total)} DA</td>
      <td>
        <button class="smallbtn" onclick="openCommandWhatsApp('${i}')">WhatsApp</button>
        <button class="smallbtn" onclick="deleteCommand(${i})" style="background:#ef4444">Suppr</button>
      </td>
    </tr>`;
  });
  table.innerHTML = html;
}
function openCommandWhatsApp(index){
  const c = commandes[index];
  if(!c) return;
  const msg = encodeURIComponent(`Salam, commande: ${c.produit}\nNom: ${c.nom}\nT√©l: ${c.tel}${c.tel2 ? ' / '+c.tel2 : ''}\nWilaya: ${c.wilaya}\nType: ${c.type}\nTotal: ${c.total} DA`);
  window.open(`https://wa.me/213699039372?text=${msg}`, "_blank");
}
function deleteCommand(index){
  if(!confirm("Supprimer cette commande ?")) return;
  commandes.splice(index,1);
  saveAll();
  renderAdminCommandsTable();
}
function confirmDeleteAllCommands(){
  if(!confirm("Supprimer toutes les commandes ?")) return;
  commandes = [];
  saveAll();
  renderAdminCommandsTable();
}
function exportCommandes(){
  if(commandes.length === 0){ alert("Aucune commande √† exporter."); return; }
  const csv = [
    ["id","produit","nom","tel","tel2","wilaya","type","prixProduit","prixLivraison","total","date"].join(","),
    ...commandes.map(c => [c.id, quote(c.produit), quote(c.nom), quote(c.tel), quote(c.tel2||""), quote(c.wilaya), quote(c.type), c.prixProduit, c.prixLivraison, c.total, c.date].join(","))
  ].join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "commandes_techno_direct.csv"; document.body.appendChild(a); a.click(); a.remove();
}

/* -------- Admin: prix par wilaya -------- */
function renderAdminPrixWilaya(){
  const root = document.getElementById("admin_prix_wilaya");
  root.innerHTML = "";
  WILAYAS.forEach(w => {
    const {dom,bur} = prixParWilaya[w] || {dom:800,bur:520};
    const row = document.createElement("div");
    row.style.display = "flex"; row.style.justifyContent="space-between"; row.style.alignItems="center";
    row.style.padding = "6px 0";
    row.innerHTML = `<div style="width:40%">${w}</div>
      <div style="width:28%"><input type="number" value="${dom}" onchange="prixParWilaya['${w}'].dom=parseInt(this.value)"></div>
      <div style="width:28%"><input type="number" value="${bur}" onchange="prixParWilaya['${w}'].bur=parseInt(this.value)"></div>`;
    root.appendChild(row);
  });
}
function savePrixWilaya(){ saveAll(); alert("‚úÖ Prix de livraison sauvegard√©s."); }
function resetPrixParDefaut(){ if(confirm("R√©initialiser tous les prix aux valeurs par d√©faut ?")){ prixParWilaya = {}; WILAYAS.forEach(w=> prixParWilaya[w] = {dom:PRIX_LIVRAISON[w][0],bur:PRIX_LIVRAISON[w][1]}); saveAll(); renderAdminPrixWilaya(); alert("R√©initialis√©."); } }

/* -------- Admin: livraison gratuite toggle -------- */
function toggleLivraisonGratuiteAdmin(){
  livraisonGratuite = !livraisonGratuite;
  saveAll();
  buildAdminUI();
  renderCatalogue();
  alert(livraisonGratuite ? "Livraison gratuite activ√©e." : "Livraison gratuite d√©sactiv√©e.");
}

/* -------- Save / load all -------- */
function saveAll(){
  saveStorage("td_affiches", affiches);
  saveStorage("td_commandes", commandes);
  saveStorage("td_prix_wilaya", prixParWilaya);
  saveStorage("td_livraison_gratuite", livraisonGratuite);
}

/* -------- Utilities: fill wilaya select for public modal -------- */
function fillWilayaSelect(selectId){
  const sel = document.getElementById(selectId);
  if(!sel) return;
  if(sel.dataset.filled) return;
  sel.innerHTML = '<option value="">Choisir une wilaya</option>';
  WILAYAS.forEach(w => {
    sel.innerHTML += `<option value="${w}">${w}</option>`;
  });
  sel.dataset.filled = "1";
}

/* -------- Escape helper to prevent injection in HTML strings -------- */
function escapeHtml(s){ if(!s) return ""; return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'", "&#39;"); }
function quote(s){ if(s==null) return '""'; return '"' + (""+s).replace(/"/g,'""') + '"' }

/* -------- Init on load -------- */
window.addEventListener("load", ()=>{
  fillWilayaSelect("cmd_wilaya");
  renderCatalogue();
});

/* expose some functions to global scope for buttons */
window.openCommandeModal = openCommandeModal;
window.closeCommande = closeCommande;
window.submitCommande = submitCommande;
window.openWhatsApp = openWhatsApp;
window.loginAdmin = function(){
  const pwd = prompt("Mot de passe :");
  if(pwd === "technoid"){ openAdminFull(); } else { alert("Mot de passe incorrect"); }
};
window.openAdminEdit = openAdminEdit;
window.saveAll = saveAll;
window.renderCatalogue = renderCatalogue;
window.renderAdminCommandsTable = renderAdminCommandsTable;
window.populateEditForm = populateEditForm;
window.saveAffiche = saveAffiche;
window.deleteAffiche = deleteAffiche;
window.pickImageFile = pickImageFile;
window.clearImagePreview = clearImagePreview;
window.moveAfficheUp = moveAfficheUp;
window.moveAfficheDown = moveAfficheDown;
window.savePrixWilaya = savePrixWilaya;
window.toggleLivraisonGratuiteAdmin = toggleLivraisonGratuiteAdmin;
window.exportCommandes = exportCommandes;
window.deleteCommand = deleteCommand;
window.confirmDeleteAllCommands = confirmDeleteAllCommands;
</script>

<!-- ========== FIN PARTIE 2/3 ========== -->
</body>
</html>
