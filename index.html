<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Techno Direct ‚Äì PC Portables</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 20px;
  }
  .card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    overflow: hidden;
    max-width: 400px;
  }
  .card img {
    width: 100%;
    height: auto;
  }
  .info {
    padding: 15px;
  }
  .price {
    color: green;
    font-weight: bold;
  }
  .btn {
    background: #0088cc;
    color: white;
    border: none;
    padding: 8px 12px;
    margin: 5px 0;
    border-radius: 5px;
    cursor: pointer;
    display: inline-block;
  }
  .btn.edit { background: #444; }
  .admin-zone {
    display: none;
    background: #222;
    color: white;
    padding: 10px;
    border-radius: 5px;
    margin-top: 20px;
  }
  .file-input { display: none; }
  #adminTrigger {
    position: fixed;
    top: 0;
    left: 0;
    width: 100px;
    height: 100px;
    cursor: pointer;
    z-index: 1000;
    background: transparent;
  }
  .commande {
    background: #333;
    padding: 8px;
    margin: 8px 0;
    border-radius: 4px;
  }
  .commande strong { color: #0f0; }
  #effacerCommandes {
    background: red;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 10px;
  }
  #exportExcel {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 5px;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<div id="adminTrigger"></div>

<!-- Produit 1 -->
<div class="card" data-produit="Lenovo ThinkPad T480" data-prix="72000">
  <img src="https://images.unsplash.com/photo-1541807084-5c52b6b3adef?auto=format&fit=crop&w=800&q=60" alt="ThinkPad">
  <div class="info">
    <h2>Lenovo ThinkPad T480</h2>
    <p>Intel Core i7-8650U ‚Ä¢ 16 Go DDR4 ‚Ä¢ SSD 512 Go ‚Ä¢ 14‚Ä≥ Full HD</p>
    <p class="price prix-produit" data-prix="72000">72 000 DA</p>
    <label>Wilaya :
      <select class="wilaya">
        <option value="">-- S√©lectionner --</option>
        <option>Alger</option><option>Oran</option><option>Tizi Ouzou</option>
      </select>
    </label>
    <p><strong>Total :</strong> <span class="montant">72 000 DA</span></p>
    <button class="btn formulaire">Remplir le formulaire</button>
  </div>
</div>

<!-- Produit 2 -->
<div class="card" data-produit="MacBook Air 2018" data-prix="94000">
  <img src="https://images.unsplash.com/photo-1629131726692-1accd0c53ce0?auto=format&fit=crop&w=800&q=60" alt="MacBook">
  <div class="info">
    <h2>MacBook Air 2018</h2>
    <p>Intel Core i5 ‚Ä¢ 8 Go ‚Ä¢ SSD 256 Go ‚Ä¢ 13,3‚Ä≥ Retina</p>
    <p class="price prix-produit" data-prix="94000">94 000 DA</p>
    <label>Wilaya :
      <select class="wilaya">
        <option value="">-- S√©lectionner --</option>
        <option>Alger</option><option>Oran</option><option>Tizi Ouzou</option>
      </select>
    </label>
    <p><strong>Total :</strong> <span class="montant">94 000 DA</span></p>
    <button class="btn formulaire">Remplir le formulaire</button>
  </div>
</div>

<!-- Zone admin -->
<div class="admin-zone" id="adminZone">
  <h3>‚öôÔ∏è Zone Admin</h3>
  <h4>üìã Historique des modifications</h4>
  <pre id="adminPre"></pre>
  <h4>üßæ Commandes clients</h4>
  <button id="effacerCommandes">Effacer toutes les commandes üóëÔ∏è</button>
  <button id="exportExcel">Exporter en Excel üì¶</button>
  <div id="listeCommandes"></div>
</div>

<script>
document.getElementById("adminTrigger").addEventListener("dblclick", () => {
  const mdp = prompt("Entrer le mot de passe admin :");
  if (mdp === "technoid") {
    const adminZone = document.getElementById("adminZone");
    adminZone.style.display = "block";
    chargerCommandes();
    ajouterBoutonsEdition();
  }
});

function ajouterBoutonsEdition() {
  const produits = document.querySelectorAll(".card");
  produits.forEach(card => {
    if (!card.querySelector(".btn.edit")) {
      const editBtn = document.createElement("button");
      editBtn.textContent = "Modifier ce produit";
      editBtn.className = "btn edit";
      card.querySelector(".info").appendChild(editBtn);

      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.accept = "image/*";
      fileInput.className = "file-input";
      card.appendChild(fileInput);

      editBtn.addEventListener("click", () => {
        const titre = card.querySelector("h2");
        const desc = card.querySelector(".info p");
        const prix = card.querySelector(".prix-produit");
        const img = card.querySelector("img");

        const nvNom = prompt("Nom du produit :", titre.textContent);
        const nvDesc = prompt("Description :", desc.textContent);
        const nvPrix = prompt("Prix (en DA) :", prix.dataset.prix);

        if (nvNom) titre.textContent = nvNom;
        if (nvDesc) desc.textContent = nvDesc;
        if (nvPrix) {
          prix.dataset.prix = nvPrix;
          prix.textContent = nvPrix + " DA";
          card.querySelector(".montant").textContent = nvPrix + " DA";
        }

        if (confirm("Changer l'image ?")) {
          fileInput.click();
          fileInput.onchange = e => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = ev => img.src = ev.target.result;
              reader.readAsDataURL(file);
            }
          };
        }

        const adminPre = document.getElementById("adminPre");
        adminPre.textContent += `Produit modifi√© : ${nvNom || titre.textContent} ‚Äì ${nvPrix || prix.dataset.prix} DA\n`;
      });
    }
  });
}

document.querySelectorAll(".formulaire").forEach(btn => {
  btn.addEventListener("click", e => {
    const card = e.target.closest(".card");
    const produit = card.querySelector("h2").textContent;
    const prix = card.querySelector(".prix-produit").dataset.prix;
    const wilaya = card.querySelector(".wilaya").value;
    const nom = prompt("Nom complet :");
    const numero = prompt("Num√©ro de t√©l√©phone :");

    if (nom && numero && wilaya) {
      const commande = { nom, numero, wilaya, produit, prix, date: new Date().toLocaleString() };
      enregistrerCommande(commande);
      alert("Commande enregistr√©e ‚úÖ");
    } else {
      alert("Veuillez remplir tous les champs !");
    }
  });
});

function enregistrerCommande(cmd) {
  let commandes = JSON.parse(localStorage.getItem("commandes") || "[]");
  commandes.push(cmd);
  localStorage.setItem("commandes", JSON.stringify(commandes));
}

function chargerCommandes() {
  const liste = document.getElementById("listeCommandes");
  liste.innerHTML = "";
  let commandes = JSON.parse(localStorage.getItem("commandes") || "[]");
  if (commandes.length === 0) {
    liste.innerHTML = "<p>Aucune commande enregistr√©e.</p>";
    return;
  }
  commandes.forEach(c => {
    const div = document.createElement("div");
    div.className = "commande";
    div.innerHTML = `<strong>${c.nom}</strong> (${c.numero}) ‚Äì ${c.produit}<br>üìç ${c.wilaya} | üí∞ ${c.prix} DA<br>üïí ${c.date}`;
    liste.appendChild(div);
  });
}

document.getElementById("effacerCommandes").addEventListener("click", () => {
  if (confirm("Supprimer toutes les commandes ?")) {
    localStorage.removeItem("commandes");
    document.getElementById("listeCommandes").innerHTML = "<p>Aucune commande enregistr√©e.</p>";
    alert("Toutes les commandes ont √©t√© supprim√©es üóëÔ∏è");
  }
});

document.getElementById("exportExcel").addEventListener("click", () => {
  let commandes = JSON.parse(localStorage.getItem("commandes") || "[]");
  if (commandes.length === 0) {
    alert("Aucune commande √† exporter !");
    return;
  }
  const ws = XLSX.utils.json_to_sheet(commandes);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Commandes");
  XLSX.writeFile(wb, "Commandes_TechnoDirect.xlsx");
});
</script>

</body>
</html>
