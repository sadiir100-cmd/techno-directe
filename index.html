<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Techno Directe – Catalogue + Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#ff6b00;--dark:#222;--light:#f7f7f7;--font:'Cairo',sans-serif;}
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font);}
    body{background:var(--light);color:var(--dark);line-height:1.6;}
    header{background:var(--dark);color:#fff;padding:1.2rem 1rem;text-align:center;position:relative;}
    header h1{font-size:2rem;font-weight:700;}
    #zoneDblClick{position:absolute;top:0;left:0;width:80px;height:80px;}
    .lang-switch{position:absolute;right:1rem;top:1.2rem;background:var(--accent);color:#fff;border:none;padding:.4rem .8rem;border-radius:4px;cursor:pointer;}
    body[dir="rtl"] .lang-switch{left:1rem;right:auto;}
    .container{max-width:1000px;margin:auto;padding:1rem;}
    .catalogue-header{font-weight:700;font-size:1.2rem;padding:.5rem;background:#fff;margin-bottom:1rem;border-radius:6px;text-align:center;}
    .card{display:flex;flex-direction:column;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1);margin:1rem 0;cursor:pointer;}
    .card img{width:100%;height:200px;object-fit:cover;}
    .info{padding:1rem;}
    .price{font-size:1.5rem;font-weight:700;color:var(--accent);}
    .btn{background:var(--accent);color:#fff;padding:.75rem 1.2rem;border:none;border-radius:4px;cursor:pointer;font-size:1rem;margin:.3rem .3rem 0 0;display:inline-block;text-decoration:none;}
    .btn:hover{background:#e55a00;}
    select{margin:.5rem 0;padding:.5rem;width:100%;max-width:300px;}
    @media(min-width:600px){.card{flex-direction:row;}.card img{width:260px;height:auto;}}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:999;}
    .modal{background:#fff;border-radius:8px;width:90%;max-width:500px;padding:1.5rem;position:relative;}
    .modal .close{position:absolute;top:.7rem;right:.7rem;background:none;border:none;font-size:1.4rem;cursor:pointer;}
    body[dir="rtl"] .modal .close{left:.7rem;right:auto;}
    .admin-panel{background:#ffeaa7;padding:1rem;border-radius:6px;margin:2rem 0;display:none;}
    .admin-item{border:1px solid var(--accent);padding:.7rem;margin:.5rem 0;border-radius:4px;background:#fff;cursor:grab;}
    .admin-item input[type=text],.admin-item input[type=number],.admin-item input[type=file]{width:100%;margin:.3rem 0;}
    .admin-item img{max-width:120px;display:block;margin:.3rem 0;}
    #addAffiches{margin-bottom:1rem;}
    #commandesList{max-height:300px;overflow:auto;background:#fff;padding:.5rem;border:1px solid #ccc;border-radius:4px;margin-top:.7rem;}
    .cmd-line{display:flex;justify-content:space-between;align-items:center;padding:.2rem 0;}
    .cmd-line button{background:none;border:none;color:var(--accent);font-size:1.2rem;cursor:pointer;}
    .drag-handle{cursor:grab;margin-right:.5rem;}
    .free-delivery-banner{background:green;color:#fff;padding:.3rem .6rem;border-radius:4px;margin-top:.5rem;font-weight:700;text-align:center;}
  </style>
</head>
<body>
  <header>
    <div id="zoneDblClick"></div>
    <h1 id="h1-title">Techno Directe</h1>
    <button class="lang-switch" id="langBtn">العربية</button>
  </header>

  <div class="container">
    <div class="catalogue-header" id="catalogueHeader">Cartable gratuit plus garantie</div>
    <div id="catalogue"></div>

    <div class="admin-panel" id="adminPanel">
      <h2>Zone Admin</h2>
      <button class="btn" id="addAffiches">+ Ajouter une affiche (max 20)</button>
      <button class="btn" id="toggleDelivery">Activer livraison gratuite</button>
      <div id="adminList"></div>
      <button class="btn" onclick="saveCatalog()">Sauvegarder les changements</button>

      <h3 style="margin-top:1.2rem">Commandes reçues (formulaire)
        <label style="margin-left:1rem;font-size:.9rem;font-weight:normal;">
          <input type="checkbox" id="selectAll"> Tout sélectionner
        </label>
        <button class="btn" onclick="deleteSelected()" style="margin-left:.5rem;">Tout supprimer</button>
      </h3>
      <div id="commandesList"></div>
    </div>
  </div>

  <div class="modal-overlay" id="passModal">
    <div class="modal">
      <button class="close" onclick="closePassModal()">&times;</button>
      <h3>Entrez le mot de passe</h3>
      <input type="password" id="passInput" placeholder="Mot de passe" style="width:100%;padding:.5rem;margin:.7rem 0;">
      <button class="btn" onclick="checkPass()">Valider</button>
    </div>
  </div>

  <div class="modal-overlay" id="imgModal">
    <div class="modal">
      <button class="close" onclick="this.closest('.modal-overlay').style.display='none'">&times;</button>
      <img id="imgModalContent" src="" style="width:100%;">
    </div>
  </div>

  <footer style="text-align:center;padding:1.5rem;font-size:.85rem;color:#777;">
    Contact : 0699039372 / 0560072059 (WhatsApp / appel) <br>
    Facebook : TECHNO DIRECT | Instagram : TECHNO _DIRECT
  </footer>

  <script>
    const PASSWORD = 'technoid';
    const MAX_AFFICHES = 20;
    let freeDelivery = false;

    // ton code original ici (catalogue, commandes, admin, langues, etc.)
    // J'ajoute seulement les nouvelles fonctionnalités ci-dessous

    // 1. Cliquer sur la photo pour agrandir
    function attachImageClick(){
      document.querySelectorAll('.card img').forEach(img=>{
        img.onclick = ()=> {
          const modal = document.getElementById('imgModal');
          const modalImg = document.getElementById('imgModalContent');
          modalImg.src = img.src;
          modal.style.display = 'flex';
        };
      });
    }

    // 2. Livraison gratuite
    document.getElementById('toggleDelivery').onclick = ()=>{
      freeDelivery = !freeDelivery;
      document.querySelectorAll('.card').forEach(card=>{
        const sel = card.querySelector('.wilaya');
        const totSpan = card.querySelector('.montant');
        const prix = parseInt(card.querySelector('.prix-produit').dataset.prix);
        if(freeDelivery){
          totSpan.textContent = (prix).toLocaleString('fr-DZ') + ' DA (Livraison gratuite)';
        } else {
          const liv = parseInt(sel.value)||0;
          totSpan.textContent = (prix+liv).toLocaleString('fr-DZ') + ' DA';
        }
      });
    };

    // 3. Réorganisation par glisser-déposer
    function makeAdminSortable(){
      const list = document.getElementById('adminList');
      let dragSrcEl = null;

      function handleDragStart(e){
        dragSrcEl = this;
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
      }
      function handleDragOver(e){
        if(e.preventDefault) e.preventDefault();
        return false;
      }
      function handleDrop(e){
        if(dragSrcEl != this){
          let tmp = this.innerHTML;
          this.innerHTML = dragSrcEl.innerHTML;
          dragSrcEl.innerHTML = tmp;
          // mettre à jour le tableau catalogue
          const items = [...list.children];
          catalogue = items.map((div,idx)=>{
            return {
              id:idx+1,
              name: div.querySelector('input[placeholder="Nom"]').value,
              desc: div.querySelector('input[placeholder="Description"]').value,
              price: parseInt(div.querySelector('input[placeholder="Prix"]').value)||0,
              img: div.querySelector('img').src
            };
          });
          saveCatalog();
        }
        return false;
      }
      list.querySelectorAll('.admin-item').forEach(item=>{
        item.setAttribute('draggable','true');
        item.addEventListener('dragstart', handleDragStart, false);
        item.addEventListener('dragover', handleDragOver, false);
        item.addEventListener('drop', handleDrop, false);
      });
    }

    // appeler ces fonctions après le rendu
    function attachExtras(){
      attachImageClick();
      makeAdminSortable();
    }
    // Appeler après renderCatalog() et renderAdminList()
  </script>
</body>
</html>
