<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Techno Directe â€“ Catalogue + Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#ff6b00;--dark:#222;--light:#f7f7f7;--font:'Cairo',sans-serif;}
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font);}
    body{background:var(--light);color:var(--dark);line-height:1.6;}
    header{background:var(--dark);color:#fff;padding:1.2rem 1rem;text-align:center;position:relative;}
    header h1{font-size:2rem;font-weight:700;}
    #zoneDblClick{position:absolute;top:0;left:0;width:80px;height:80px;}
    .lang-switch{position:absolute;right:1rem;top:1.2rem;background:var(--accent);color:#fff;border:none;padding:.4rem .8rem;border-radius:4px;cursor:pointer;}
    body[dir="rtl"] .lang-switch{left:1rem;right:auto;}
    #topBanner{background:var(--accent);color:#fff;text-align:center;padding:.6rem;font-weight:700;}
    .container{max-width:1000px;margin:auto;padding:1rem;}
    .card{display:flex;flex-direction:column;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1);margin:1rem 0;}
    .card img{width:100%;height:200px;object-fit:cover;cursor:zoom-in;}
    .info{padding:1rem;}
    .price{font-size:1.5rem;font-weight:700;color:var(--accent);}
    .btn{background:var(--accent);color:#fff;padding:.75rem 1.2rem;border:none;border-radius:4px;cursor:pointer;font-size:1rem;margin:.3rem .3rem 0 0;display:inline-block;text-decoration:none;}
    .btn:hover{background:#e55a00;}
    select{margin:.5rem 0;padding:.5rem;width:100%;max-width:300px;}
    @media(min-width:600px){.card{flex-direction:row;}.card img{width:260px;height:auto;}}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:999;}
    .modal{background:#fff;border-radius:8px;width:90%;max-width:500px;padding:1.5rem;position:relative;}
    .modal .close{position:absolute;top:.7rem;right:.7rem;background:none;border:none;font-size:1.4rem;cursor:pointer;}
    body[dir="rtl"] .modal .close{left:.7rem;right:auto;}
    .admin-panel{background:#ffeaa7;padding:1rem;border-radius:6px;margin:2rem 0;display:none;}
    .admin-item{border:1px solid var(--accent);padding:.7rem;margin:.5rem 0;border-radius:4px;background:#fff;}
    .admin-item input[type=text],.admin-item input[type=number],.admin-item input[type=file]{width:100%;margin:.3rem 0;}
    .admin-item img{max-width:120px;display:block;margin:.3rem 0;}
    #adminList.sortable .admin-item{cursor:grab;transition:transform .2s;}
    #adminList.sortable .admin-item.dragging{opacity:.5;transform:scale(1.02);}
    #addAffiches{margin-bottom:1rem;}
    #commandesList{max-height:300px;overflow:auto;background:#fff;padding:.5rem;border:1px solid #ccc;border-radius:4px;margin-top:.7rem;}
    .cmd-line{display:flex;justify-content:space-between;align-items:center;padding:.2rem 0;}
    .cmd-line button{background:none;border:none;color:var(--accent);font-size:1.2rem;cursor:pointer;}
    .freeBadge{background:#28a745;color:#fff;padding:2px 6px;border-radius:3px;font-size:.75rem;margin-left:.5rem;}
  </style>
</head>
<body>
  <header>
    <div id="zoneDblClick"></div>
    <h1 id="h1-title">Techno Directe</h1>
    <button class="lang-switch" id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
  </header>
  <div id="topBanner">ðŸŽ’ CARTABLE GRATUIT + GARANTIE ðŸŽ’</div>

  <div class="container">
    <div id="catalogue"></div>
    <div class="admin-panel" id="adminPanel">
      <h2>Zone Admin</h2>
      <button class="btn" id="addAffiches">+ Ajouter une affiche (max 20)</button>
      <button class="btn" id="toggleSortBtn">Activer le tri (glisser-dÃ©poser)</button>
      <button class="btn" id="freeDeliveryBtn" style="background:#28a745;margin-top:.5rem;">Activer livraison gratuite 58 wilayas</button>
      <div id="adminList"></div>
      <button class="btn" onclick="saveCatalog()">Sauvegarder les changements</button>

      <h3 style="margin-top:1.2rem">Commandes reÃ§ues (formulaire)
        <label style="margin-left:1rem;font-size:.9rem;font-weight:normal;">
          <input type="checkbox" id="selectAll"> Tout sÃ©lectionner
        </label>
        <button class="btn" onclick="deleteSelected()" style="margin-left:.5rem;">Tout supprimer</button>
      </h3>
      <div id="commandesList"></div>
    </div>
  </div>

  <div class="modal-overlay" id="passModal">
    <div class="modal">
      <button class="close" onclick="closePassModal()">&times;</button>
      <h3>Entrez le mot de passe</h3>
      <input type="password" id="passInput" placeholder="Mot de passe" style="width:100%;padding:.5rem;margin:.7rem 0;">
      <button class="btn" onclick="checkPass()">Valider</button>
    </div>
  </div>

  <footer style="text-align:center;padding:1.5rem;font-size:.85rem;color:#777;">
    Contact WhatsApp : 0699039372 â€¢ 0560072059<br>
    Facebook : TECHNO DIRECT â€¢ Instagram : TECHNO_DIRECT
  </footer>

  <script>
    const PASSWORD = 'technoid';
    const MAX_AFFICHES = 20;
    const PHONE1 = '213699039372';
    const PHONE2 = '213560072059';
    let freeDeliveryMode = false; // mode livraison gratuite
    const WILAYAS = [
      {fr:'ADRAR',ar:'Ø£Ø¯Ø±Ø§Ø±',prix:1400},{fr:'CHLEF',ar:'Ø§Ù„Ø´Ù„Ù',prix:800},{fr:'LAGHOUAT',ar:'Ø§Ù„Ø£ØºÙˆØ§Ø·',prix:950},{fr:'OUM EL BOUAGHI',ar:'Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ',prix:800},{fr:'BATNA',ar:'Ø¨Ø§ØªÙ†Ø©',prix:800},{fr:'BEJAIA',ar:'Ø¨Ø¬Ø§ÙŠØ©',prix:450},{fr:'BISKRA',ar:'Ø¨Ø³ÙƒØ±Ø©',prix:950},{fr:'BECHAR',ar:'Ø¨Ø´Ø§Ø±',prix:1100},{fr:'BLIDA',ar:'Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©',prix:750},{fr:'BOUIRA',ar:'Ø§Ù„Ø¨ÙˆÙŠØ±Ø©',prix:700},{fr:'TAMANRASSET',ar:'ØªÙ…Ù†Ø±Ø§Ø³Øª',prix:1600},{fr:'TEBESSA',ar:'ØªØ¨Ø³Ø©',prix:800},{fr:'TLEMCEN',ar:'ØªÙ„Ù…Ø³Ø§Ù†',prix:900},{fr:'TIARET',ar:'ØªÙŠØ§Ø±Øª',prix:800},{fr:'TIZI OUZOU',ar:'ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ',prix:650},{fr:'ALGER',ar:'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',prix:600},{fr:'DJELFA',ar:'Ø§Ù„Ø¬Ù„ÙØ©',prix:950},{fr:'JUEL',ar:'Ø¬ÙŠØ¬Ù„',prix:700},{fr:'SETIF',ar:'Ø³Ø·ÙŠÙ',prix:750},{fr:'SAIDA',ar:'Ø³Ø¹ÙŠØ¯Ø©',prix:800},{fr:'SKIKDA',ar:'Ø³ÙƒÙŠÙƒØ¯Ø©',prix:750},{fr:'SIDIBELABBES',ar:'Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³',prix:750},{fr:'ANNABA',ar:'Ø¹Ù†Ø§Ø¨Ø©',prix:800},{fr:'GUELMA',ar:'Ù‚Ø§Ù„Ù…Ø©',prix:800},{fr:'CONSTANTINE',ar:'Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©',prix:750},{fr:'MEDEA',ar:'Ø§Ù„Ù…Ø¯ÙŠØ©',prix:750},{fr:'MOSTAGANEM',ar:'Ù…Ø¹Ø³ÙƒØ±',prix:750},{fr:'M\'SILA',ar:'Ø§Ù„Ù…Ø³ÙŠÙ„Ø©',prix:850},{fr:'MASCARA',ar:'Ù…ascara',prix:750},{fr:'OUARGLA',ar:'ÙˆØ±Ù‚Ù„Ø©',prix:1000},{fr:'ORAN',ar:'ÙˆÙ‡Ø±Ø§Ù†',prix:700},{fr:'EL BAYADH',ar:'Ø§Ù„Ø¨ÙŠØ¶',prix:1050},{fr:'ILLIZI',ar:'Ø¥ÙŠÙ„ÙŠØ²ÙŠ',prix:1100},{fr:'BORDJ BOU ARRERIDJ',ar:'Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬',prix:750},{fr:'BOUMERDES',ar:'Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³',prix:750},{fr:'EL TARF',ar:'Ø§Ù„Ø·Ø§Ø±Ù',prix:850},{fr:'TINDOUF',ar:'ØªÙ†Ø¯ÙˆÙ',prix:1600},{fr:'TISSEMSILT',ar:'ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª',prix:800},{fr:'EL OUED',ar:'Ø§Ù„ÙˆØ§Ø¯ÙŠ',prix:1000},{fr:'KHENCHELA',ar:'Ø®Ù†Ø´Ù„Ø©',prix:800},{fr:'SOUK AHRAS',ar:'Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³',prix:800},{fr:'TIPAZA',ar:'ØªÙŠØ¨Ø§Ø²Ø©',prix:900},{fr:'MILA',ar:'Ù…ÙŠÙ„Ø©',prix:800},{fr:'AIN DEFLA',ar:'Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰',prix:850},{fr:'NAAMA',ar:'Ø§Ù„Ù†Ø¹Ø§Ù…Ø©',prix:800},{fr:'AIN TEMOUCHENT',ar:'Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª',prix:800},{fr:'GHARDAIA',ar:'ØºØ±Ø¯Ø§ÙŠØ©',prix:800},{fr:'RELIZANE',ar:'ØºÙ„ÙŠØ²Ø§Ù†',prix:800},{fr:'TIMIMOUN',ar:'ØªÙŠÙ…ÙŠÙ…ÙˆÙ†',prix:800},{fr:'BORDJ BADJI MOKHTAR',ar:'Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±',prix:800},{fr:'OULED DJELLAL',ar:'Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„',prix:800},{fr:'BENI ABBES',ar:'Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³',prix:800},{fr:'IN SALAH',ar:'Ø¹ÙŠÙ† ØµØ§Ù„Ø­',prix:800},{fr:'IN GUEZZAM',ar:'Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…',prix:800},{fr:'TOUGGOURT',ar:'ØªÙ‚Ø±Øª',prix:800},{fr:'DJANET',ar:'Ø¬Ø§Ù†Øª',prix:800},{fr:'MGHAIR',ar:'Ø§Ù„Ø§ØºÙˆØ§Ø·',prix:800},{fr:'EL MENIAA',ar:'Ø§Ù„Ù…Ù†ÙŠØ¹Ø©',prix:800}
    ];
    let lang = 'fr';
    const body = document.body;
    const txt = {
      fr:{h1:'Techno Directe',btnLang:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',modalTitle:'Formulaire de commande',placeholderNom:'Nom',placeholderPrenom:'PrÃ©nom',placeholderTel1:'TÃ©lÃ©phone 1',placeholderTel2:'TÃ©lÃ©phone 2 (facultatif)',radioBureau:'Bureau de poste',radioDomicile:'Ã€ domicile',submit:'Envoyer la commande',labelWilaya:'Wilaya de livraison :',commanderWhatsapp:'Commander sur WhatsApp',commanderForm:'Commander ici',total:'Total :',adminTitle:'Zone Admin â€“ Commandes formulaire',addAffiche:'+ Ajouter une affiche (max 20)',save:'Sauvegarder les changements'},
      ar:{h1:'ØªÙƒÙ†Ùˆ Ø¯Ø§ÙŠØ±ÙƒØª',btnLang:'FranÃ§ais',modalTitle:'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨',placeholderNom:'Ø§Ù„Ù„Ù‚Ø¨',placeholderPrenom:'Ø§Ù„Ø§Ø³Ù…',placeholderTel1:'Ø§Ù„Ù‡Ø§ØªÙ 1',placeholderTel2:'Ø§Ù„Ù‡Ø§ØªÙ 2 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',radioBureau:'Ù…ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯',radioDomicile:'ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„',submit:'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨',labelWilaya:'ÙˆÙ„Ø§ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„ :',commanderWhatsapp:'Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨',commanderForm:'Ø§Ø·Ù„Ø¨ Ù‡Ù†Ø§',total:'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ :',adminTitle:'Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù† â€“ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬',addAffiche:'+ Ø¥Ø¶Ø§ÙØ© Ù…Ù„ØµÙ‚ (max 20)',save:'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª'}
    };
    const DEFAULT_CATALOG = [
      {id:1, name:'HP EliteBook 840 G5',desc:'Intel Core i5-8250U â€¢ 8 Go DDR4 â€¢ SSD 256 Go â€¢ 14â€³ Full HD',price:50000,img:'https://images.unsplash.com/photo-1593640408182-31c70c8268f5?auto=format&fit=crop&w=800&q=60'},
      {id:2, name:'Lenovo ThinkPad T480',desc:'Intel Core i7-8650U â€¢ 16 Go DDR4 â€¢ SSD 512 Go â€¢ 14â€³ Full HD',price:72000,img:'https://images.unsplash.com/photo/1541807084-5c52b6b3adef?auto=format&fit=crop&w=800&q=60'},
      {id:3, name:'MacBook Air 2018',desc:'Intel Core i5 â€¢ 8 Go â€¢ SSD 256 Go â€¢ 13,3â€³ Retina',price:94000,img:'https://images.unsplash.com/photo-1629131726692-1accd0c53ce0?auto=format&fit=crop&w=800&q=60'}
    ];
    let catalogue = [];

    initCatalog();
    renderCatalog();
    attachEvents();
    updateLang();
    showCommandes();

    function initCatalog(){
      const saved = localStorage.getItem('technoCatalog');
      if (saved) catalogue = JSON.parse(saved);
      else { catalogue = JSON.parse(JSON.stringify(DEFAULT_CATALOG)); saveCatalog(); }
    }
    function saveCatalog(){
      localStorage.setItem('technoCatalog', JSON.stringify(catalogue));
    }
    function renderCatalog(){
      const cont = document.getElementById('catalogue');
      cont.innerHTML = '';
      catalogue.forEach(prod=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${prod.img}" alt="${prod.name}">
          <div class="info">
            <h2>${prod.name}</h2>
            <p>${prod.desc}</p>
            <p class="price prix-produit" data-prix="${prod.price}">${prod.price.toLocaleString('fr-DZ')} DA</p>
            <div class="livraison-box">
              <label class="label-wilaya">${txt[lang].labelWilaya}
                <select class="wilaya" required></select>
              </label>
              <span class="freeBadge" style="display:none;">${lang==='fr'?'Livraison gratuite 58 wilayas':'ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ù¥Ù¨ ÙˆÙ„Ø§ÙŠØ©'}</span>
            </div>
            <p class="total"><strong>${txt[lang].total} <span class="montant">${prod.price.toLocaleString('fr-DZ')} DA</span></strong></p>
            <a class="btn whatsapp" href="#">${txt[lang].commanderWhatsapp}</a>
            <button class="btn formulaire" data-id="${prod.id}">${txt[lang].commanderForm}</button>
          </div>`;
        cont.appendChild(card);
      });
      fillWilayaSelects();
      attachCardEvents();
      handleFreeDeliveryUI();
    }
    function fillWilayaSelects(){
      document.querySelectorAll('.wilaya').forEach(sel=>{
        sel.innerHTML = '<option value="">-- '+ (lang==='fr'?'Choisir':'Ø§Ø®ØªØ±') +' --</option>';
        WILAYAS.forEach(w=>{
          const opt = document.createElement('option');
          opt.value = w.prix;
          opt.textContent = lang==='fr'? w.fr : w.ar;
          opt.dataset.nom = w.fr;
          sel.appendChild(opt);
        });
      });
    }
    function attachCardEvents(){
      document.querySelectorAll('.card').forEach(card=>{
        const prix = parseInt(card.querySelector('.prix-produit').dataset.prix);
        const sel = card.querySelector('.wilaya');
        const mont = card.querySelector('.montant');
        const whats = card.querySelector('.whatsapp');
        function upd(){
          const liv = parseInt(sel.value)||0; const tot = prix + liv;
          mont.textContent = tot.toLocaleString('fr-DZ') + ' DA';
          const prodName = card.querySelector('h2').textContent;
          const wtxt = lang==='fr'?
            `Bonjour Techno Directe, je veux commander : ${prodName} (Total : ${tot} DA)`:
            `Ù…Ø±Ø­Ø¨Ø§ ØªÙƒÙ†Ùˆ Ø¯Ø§ÙŠØ±ÙƒØªØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨ : ${prodName} (Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ : ${tot} Ø¯Ø¬)`;
          whats.href = `https://wa.me/${PHONE1}?text=${encodeURIComponent(wtxt)}`;
        }
        sel.onchange = upd; upd();
      });
    }
    function handleFreeDeliveryUI(){
      const freeMode = WILAYAS.every(w=>w.prix===0);
      document.querySelectorAll('.card').forEach(card=>{
        const sel = card.querySelector('.wilaya');
        const badge = card.querySelector('.freeBadge');
        if (freeMode){
          sel.style.display='none';
          badge.style.display='inline-block';
        }else{
          sel.style.display='inline-block';
          badge.style.display='none';
        }
      });
    }
    function attachEvents(){
      document.getElementById('langBtn').onclick = ()=>{ lang = lang==='fr'?'ar':'fr'; updateLang(); fillWilayaSelects(); renderCatalog(); };
      document.getElementById('zoneDblClick').ondblclick = ()=>{ document.getElementById('passModal').style.display = 'flex'; };
      document.getElementById('addAffiches').onclick = ()=>{ addEmptyAffiche(); };
      document.getElementById('freeDeliveryBtn').onclick = ()=>{
        if (!confirm('Activer la livraison gratuite pour les 58 wilayas ?')) return;
        WILAYAS.forEach(w=>w.prix=0);
        renderCatalog();
        alert('Livraison gratuite activÃ©e !');
      };
      document.addEventListener('click', e=>{
        if (e.target && e.target.classList.contains('formulaire')){
          const prodId = e.target.dataset.id;
          const prod = catalogue.find(p=>p.id==prodId);
          openFormModal(prod);
        }
        if (e.target.closest('.card img')){
          const src = e.target.src;
          const overlay = document.createElement('div');
          overlay.style.cssText = `position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;z-index:9999;cursor:zoom-out`;
          overlay.innerHTML = `<img src="${src}" style="max-width:90%;max-height:90%;object-fit:contain">`;
          overlay.onclick = ()=>overlay.remove();
          document.body.appendChild(overlay);
        }
      });
    }
    function updateLang(){
      body.dir = lang==='ar'?'rtl':'ltr';
      body.lang = lang;
      document.getElementById('h1-title').textContent = txt[lang].h1;
      document.getElementById('langBtn').textContent = txt[lang].btnLang;
      document.getElementById('addAffiches').textContent = txt[lang].addAffiche;
    }
    function closePassModal(){
      document.getElementById('passModal').style.display = 'none';
      document.getElementById('passInput').value = '';
    }
    function checkPass(){
      if (document.getElementById('passInput').value === PASSWORD){
        closePassModal();
        openAdminPanel();
      } else {
        alert('Mot de passe incorrect');
      }
    }
    function openAdminPanel(){
      document.getElementById('adminPanel').style.display = 'block';
      renderAdminList();
      showCommandes();
    }
    function renderAdminList(){
      const list = document.getElementById('adminList');
      list.innerHTML = '';
      catalogue.forEach((prod,idx)=>{
        const div = document.createElement('div');
        div.className = 'admin-item';
        div.innerHTML = `
          <h4>Affiche ${idx+1}</h4>
          <input type="text" placeholder="Nom" value="${prod.name}" onchange="catalogue[${idx}].name=this.value; saveCatalog();">
          <input type="text" placeholder="Description" value="${prod.desc}" onchange="catalogue[${idx}].desc=this.value; saveCatalog();">
          <input type="number" placeholder="Prix" value="${prod.price}" onchange="catalogue[${idx}].price=parseInt(this.value)||0; saveCatalog();">
          <input type="file" accept="image/*" onchange="changeImage(${idx},this)">
          <img src="${prod.img}" style="max-width:120px;display:block;margin:.3rem 0;">
          <button class="btn" onclick="removeAffiche(${idx})">Supprimer</button>
        `;
        list.appendChild(div);
      });
    }
    function changeImage(idx,input){
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e=>{
        catalogue[idx].img = e.target.result;
        renderAdminList();
        saveCatalog();
      };
      reader.readAsDataURL(file);
    }
    function removeAffiche(idx){
      if (catalogue.length <= 1) return alert('Il faut au moins 1 affiche');
      catalogue.splice(idx,1);
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function addEmptyAffiche(){
      if (catalogue.length >= MAX_AFFICHES) return alert('Max 20 affiches');
      const newId = catalogue.length ? Math.max(...catalogue.map(p=>p.id)) + 1 : 1;
      catalogue.push({id:newId, name:'Nouveau PC',desc:'Description ici',price:50000,img:'https://via.placeholder.com/800x600?text=Nouveau+PC'});
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    let sortable = false;
    document.getElementById('toggleSortBtn').onclick = ()=>{
      sortable = !sortable;
      const list = document.getElementById('adminList');
      list.classList.toggle('sortable', sortable);
      document.getElementById('toggleSortBtn').textContent = sortable ? 'DÃ©sactiver le tri' : 'Activer le tri (glisser-dÃ©poser)';
      sortable ? enableDrag() : disableDrag();
    };
    function enableDrag(){
      const items = document.querySelectorAll('#adminList .admin-item');
      items.forEach(item=>{
        item.draggable = true;
        item.ondragstart = e=>{
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', item.innerHTML);
          item.classList.add('dragging');
        };
        item.ondragend = ()=>item.classList.remove('dragging');
        item.ondragover = e=>e.preventDefault();
        item.ondrop = e=>{
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          if (item === dragging) return;
          const all = [...document.querySelectorAll('#adminList .admin-item')];
          const dragIndex = all.indexOf(dragging);
          const dropIndex = all.indexOf(item);
          const [removed] = catalogue.splice(dragIndex,1);
          catalogue.splice(dropIndex,0,removed);
          renderAdminList();
          saveCatalog();
          enableDrag();
        };
      });
    }
    function disableDrag(){
      document.querySelectorAll('#adminList .admin-item').forEach(i=>i.draggable=false);
    }
    function openFormModal(prod){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <h2>${txt[lang].modalTitle}</h2>
          <form id="commandeForm">
            <input type="text" name="nom" placeholder="${txt[lang].placeholderNom}" required>
            <input type="text" name="prenom" placeholder="${txt[lang].placeholderPrenom}" required>
            <select name="wilaya" required></select>
            <input type="tel" name="tel1" placeholder="${txt[lang].placeholderTel1}" required>
            <input type="tel" name="tel2" placeholder="${txt[lang].placeholderTel2}">
            <label><input type="radio" name="livraison" value="bureau" checked> ${txt[lang].radioB opt = document.createElement('option');
          opt.value = w.prix;
          opt.textContent = lang==='fr'? w.fr : w.ar;
          opt.dataset.nom = w.fr;
          sel.appendChild(opt);
        });
      });
    }
    function attachCardEvents(){
      document.querySelectorAll('.card').forEach(card=>{
        const prix = parseInt(card.querySelector('.prix-produit').dataset.prix);
        const sel = card.querySelector('.wilaya');
        const mont = card.querySelector('.montant');
        const whats = card.querySelector('.whatsapp');
        function upd(){
          const liv = parseInt(sel.value)||0; const tot = prix + liv;
          mont.textContent = tot.toLocaleString('fr-DZ') + ' DA';
          const prodName = card.querySelector('h2').textContent;
          const wtxt = lang==='fr'?
            `Bonjour Techno Directe, je veux commander : ${prodName} (Total : ${tot} DA)`:
            `Ù…Ø±Ø­Ø¨Ø§ ØªÙƒÙ†Ùˆ Ø¯Ø§ÙŠØ±ÙƒØªØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨ : ${prodName} (Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ : ${tot} Ø¯Ø¬)`;
          whats.href = `https://wa.me/${PHONE1}?text=${encodeURIComponent(wtxt)}`;
        }
        sel.onchange = upd; upd();
      });
    }
    function handleFreeDeliveryUI(){
      const freeMode = WILAYAS.every(w=>w.prix===0);
      document.querySelectorAll('.card').forEach(card=>{
        const sel = card.querySelector('.wilaya');
        const badge = card.querySelector('.freeBadge');
        if (freeMode){
          sel.style.display='none';
          badge.style.display='inline-block';
        }else{
          sel.style.display='inline-block';
          badge.style.display='none';
        }
      });
    }
    function attachEvents(){
      document.getElementById('langBtn').onclick = ()=>{ lang = lang==='fr'?'ar':'fr'; updateLang(); fillWilayaSelects(); renderCatalog(); };
      document.getElementById('zoneDblClick').ondblclick = ()=>{ document.getElementById('passModal').style.display = 'flex'; };
      document.getElementById('addAffiches').onclick = ()=>{ addEmptyAffiche(); };
      // boutons formulaire
      document.addEventListener('click', e=>{
        if (e.target && e.target.classList.contains('formulaire')){
          const prodId = e.target.dataset.id;
          const prod = catalogue.find(p=>p.id==prodId);
          openFormModal(prod);
        }
      });
    }
    function updateLang(){
      body.dir = lang==='ar'?'rtl':'ltr';
      body.lang = lang;
      document.getElementById('h1-title').textContent = txt[lang].h1;
      document.getElementById('langBtn').textContent = txt[lang].btnLang;
      document.getElementById('addAffiches').textContent = txt[lang].addAffiche;
    }
    function closePassModal(){
      document.getElementById('passModal').style.display = 'none';
      document.getElementById('passInput').value = '';
    }
    function checkPass(){
      if (document.getElementById('passInput').value === PASSWORD){
        closePassModal();
        openAdminPanel();
      } else {
        alert('Mot de passe incorrect');
      }
    }
    function openAdminPanel(){
      document.getElementById('adminPanel').style.display = 'block';
      renderAdminList();
      showCommandes();
    }
    function renderAdminList(){
      const list = document.getElementById('adminList');
      list.innerHTML = '';
      catalogue.forEach((prod,idx)=>{
        const div = document.createElement('div');
        div.className = 'admin-item';
        div.innerHTML = `
          <h4>Affiche ${idx+1}</h4>
          <input type="text" placeholder="Nom" value="${prod.name}" onchange="catalogue[${idx}].name=this.value; saveCatalog();">
          <input type="text" placeholder="Description" value="${prod.desc}" onchange="catalogue[${idx}].desc=this.value; saveCatalog();">
          <input type="number" placeholder="Prix" value="${prod.price}" onchange="catalogue[${idx}].price=parseInt(this.value)||0; saveCatalog();">
          <input type="file" accept="image/*" onchange="changeImage(${idx},this)">
          <img src="${prod.img}" style="max-width:120px;display:block;margin:.3rem 0;">
          <button class="btn" onclick="removeAffiche(${idx})">Supprimer</button>
        `;
        list.appendChild(div);
      });
    }
    function changeImage(idx,input){
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e=>{
        catalogue[idx].img = e.target.result;
        renderAdminList();
        saveCatalog();
      };
      reader.readAsDataURL(file);
    }
    function removeAffiche(idx){
      if (catalogue.length <= 1) return alert('Il faut au moins 1 affiche');
      catalogue.splice(idx,1);
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function addEmptyAffiche(){
      if (catalogue.length >= MAX_AFFICHES) return alert('Max 20 affiches');
      const newId = catalogue.length ? Math.max(...catalogue.map(p=>p.id)) + 1 : 1;
      catalogue.push({id:newId, name:'Nouveau PC',desc:'Description ici',price:50000,img:'https://via.placeholder.com/800x600?text=Nouveau+PC'});
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function openFormModal(prod){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <h2>${txt[lang].modalTitle}</h2>
          <form id="commandeForm">
            <input type="text" name="nom" placeholder="${txt[lang].placeholderNom}" required>
            <input type="text" name="prenom" placeholder="${txt[lang].placeholderPrenom}" required>
            <select name="wilaya" required></select>
            <input type="tel" name="tel1" placeholder="${txt[lang].placeholderTel1}" required>
            <input type="tel" name="tel2" placeholder="${txt[lang].placeholderTel2}">
            <label><input type="radio" name="livraison" value="bureau" checked> ${txt[lang].radioBureau}</label>
            <label><input type="radio" name="livraison" value="domicile"> ${txt[lang].radioDomicile}</label>
            <input type="hidden" name="produit" value="${prod.name}">
            <input type="hidden" name="total">
            <button type="submit" class="btn">${txt[lang].submit}</button>
          </form>
        </div>`;
      document.body.appendChild(overlay);
      const wilSel = overlay.querySelector('select[name=wilaya]');
      wilSel.innerHTML = '<option value="">-- '+ (lang==='fr'?'
