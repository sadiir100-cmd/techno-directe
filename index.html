<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Techno Directe ‚Äì Catalogue + Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#ff6b00;--dark:#222;--light:#f7f7f7;--font:'Cairo',sans-serif;}
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font);}
    body{background:var(--light);color:var(--dark);line-height:1.6;}
    header{background:var(--dark);color:#fff;padding:1.2rem 1rem;text-align:center;position:relative;}
    header h1{font-size:2rem;font-weight:700;}
    #zoneDblClick{position:absolute;top:0;left:0;width:1px;height:1px;}
    .lang-switch{position:absolute;right:1rem;top:1.2rem;background:var(--accent);color:#fff;border:none;padding:.4rem .8rem;border-radius:4px;cursor:pointer;}
    body[dir="rtl"] .lang-switch{left:1rem;right:auto;}
    .container{max-width:1000px;margin:auto;padding:1rem;}
    .card{display:flex;flex-direction:column;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1);margin:1rem 0;cursor:grab;}
    .card.dragging{opacity:.5;}
    .card img{width:100%;height:200px;object-fit:cover;cursor:pointer;}
    .info{padding:1rem;}
    .price{font-size:1.5rem;font-weight:700;color:var(--accent);}
    .btn{background:var(--accent);color:#fff;padding:.75rem 1.2rem;border:none;border-radius:4px;cursor:pointer;font-size:1rem;margin:.3rem .3rem 0 0;display:inline-block;text-decoration:none;}
    .btn:hover{background:#e55a00;}
    select{margin:.5rem 0;padding:.5rem;width:100%;max-width:300px;}
    @media(min-width:600px){.card{flex-direction:row;}.card img{width:260px;height:auto;}}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:999;}
    .modal{background:#fff;border-radius:8px;width:90%;max-width:500px;padding:1.5rem;position:relative;}
    .modal .close{position:absolute;top:.7rem;right:.7rem;background:none;border:none;font-size:1.4rem;cursor:pointer;}
    body[dir="rtl"] .modal .close{left:.7rem;right:auto;}
    .admin-panel{background:#ffeaa7;padding:1rem;border-radius:6px;margin:2rem 0;display:none;}
    .admin-item{border:1px solid var(--accent);padding:.7rem;margin:.5rem 0;border-radius:4px;background:#fff;}
    .admin-item input[type=text],.admin-item input[type=number],.admin-item input[type=file]{width:100%;margin:.3rem 0;}
    .admin-item img{max-width:120px;display:block;margin:.3rem 0;}
    #addAffiches{margin-bottom:1rem;}
    #commandesList{max-height:300px;overflow:auto;background:#fff;padding:.5rem;border:1px solid #ccc;border-radius:4px;margin-top:.7rem;}
    .cmd-line{display:flex;justify-content:space-between;align-items:center;padding:.2rem 0;}
    .cmd-line button{background:none;border:none;color:var(--accent);font-size:1.2rem;cursor:pointer;}
    .free-banner{background:var(--accent);color:#fff;text-align:center;padding:.5rem;font-weight:700;margin-bottom:1rem;border-radius:4px;}
    .social{margin:.5rem 0;font-size:.9rem;}
    .sort-hint{font-size:.8rem;color:#555;margin-left:1rem;}
    .top-banner{background:#ffeaa7;color:var(--dark);text-align:center;padding:.5rem;font-weight:700;margin-bottom:1rem;border-radius:4px;}
  </style>
</head>
<body>
  <header>
    <!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Techno Directe ‚Äì Catalogue + Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--accent:#ff6b00;--dark:#222;--light:#f7f7f7;--font:'Cairo',sans-serif;}
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font);}
    body{background:var(--light);color:var(--dark);line-height:1.6;}
    header{background:var(--dark);color:#fff;padding:1.2rem 1rem;text-align:center;position:relative;}
    header h1{font-size:2rem;font-weight:700;}
    #zoneDblClick{position:absolute;top:0;left:0;width:80px;height:80px;}
    .lang-switch{position:absolute;right:1rem;top:1.2rem;background:var(--accent);color:#fff;border:none;padding:.4rem .8rem;border-radius:4px;cursor:pointer;}
    body[dir="rtl"] .lang-switch{left:1rem;right:auto;}
    .container{max-width:1000px;margin:auto;padding:1rem;}
    .card{display:flex;flex-direction:column;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.1);margin:1rem 0;}
    .card img{width:100%;height:200px;object-fit:cover;}
    .info{padding:1rem;}
    .price{font-size:1.5rem;font-weight:700;color:var(--accent);}
    .btn{background:var(--accent);color:#fff;padding:.75rem 1.2rem;border:none;border-radius:4px;cursor:pointer;font-size:1rem;margin:.3rem .3rem 0 0;display:inline-block;text-decoration:none;}
    .btn:hover{background:#e55a00;}
    select{margin:.5rem 0;padding:.5rem;width:100%;max-width:300px;}
    @media(min-width:600px){.card{flex-direction:row;}.card img{width:260px;height:auto;}}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:999;}
    .modal{background:#fff;border-radius:8px;width:90%;max-width:500px;padding:1.5rem;position:relative;}
    .modal .close{position:absolute;top:.7rem;right:.7rem;background:none;border:none;font-size:1.4rem;cursor:pointer;}
    body[dir="rtl"] .modal .close{left:.7rem;right:auto;}
    .admin-panel{background:#ffeaa7;padding:1rem;border-radius:6px;margin:2rem 0;display:none;}
    .admin-item{border:1px solid var(--accent);padding:.7rem;margin:.5rem 0;border-radius:4px;background:#fff;}
    .admin-item input[type=text],.admin-item input[type=number],.admin-item input[type=file]{width:100%;margin:.3rem 0;}
    .admin-item img{max-width:120px;display:block;margin:.3rem 0;}
    #addAffiches{margin-bottom:1rem;}
    #commandesList{max-height:300px;overflow:auto;background:#fff;padding:.5rem;border:1px solid #ccc;border-radius:4px;margin-top:.7rem;}
    .cmd-line{display:flex;justify-content:space-between;align-items:center;padding:.2rem 0;}
    .cmd-line button{background:none;border:none;color:var(--accent);font-size:1.2rem;cursor:pointer;}
  </style>
</head>
<body>
  <header>
    <div id="zoneDblClick"></div>
    <h1 id="h1-title">Techno Directe</h1>
    <button class="lang-switch" id="langBtn">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
  </header>

  <div class="container">
    <div id="catalogue"></div>
    <div class="admin-panel" id="adminPanel">
      <h2>Zone Admin</h2>
      <button class="btn" id="addAffiches">+ Ajouter une affiche (max 20)</button>
      <div id="adminList"></div>
      <button class="btn" onclick="saveCatalog()">Sauvegarder les changements</button>

      <h3 style="margin-top:1.2rem">Commandes re√ßues (formulaire)
        <label style="margin-left:1rem;font-size:.9rem;font-weight:normal;">
          <input type="checkbox" id="selectAll"> Tout s√©lectionner
        </label>
        <button class="btn" onclick="deleteSelected()" style="margin-left:.5rem;">Tout supprimer</button>
      </h3>
      <div id="commandesList"></div>
    </div>
  </div>

  <div class="modal-overlay" id="passModal">
    <div class="modal">
      <button class="close" onclick="closePassModal()">&times;</button>
      <h3>Entrez le mot de passe</h3>
      <input type="password" id="passInput" placeholder="Mot de passe" style="width:100%;padding:.5rem;margin:.7rem 0;">
      <button class="btn" onclick="checkPass()">Valider</button>
    </div>
  </div>

  <footer style="text-align:center;padding:1.5rem;font-size:.85rem;color:#777;">
    Contact : 07 00 00 00 00 (WhatsApp / appel)
  </footer>

  <script>
    const PASSWORD = 'technoid';
    const MAX_AFFICHES = 20;
    const PHONE1 = '213699039372';
    const PHONE2 = '213560072059';
    const WILAYAS = [
      {fr:'ADRAR',ar:'ÿ£ÿØÿ±ÿßÿ±',prix:1400},{fr:'CHLEF',ar:'ÿßŸÑÿ¥ŸÑŸÅ',prix:800},{fr:'LAGHOUAT',ar:'ÿßŸÑÿ£ÿ∫Ÿàÿßÿ∑',prix:950},{fr:'OUM EL BOUAGHI',ar:'ÿ£ŸÖ ÿßŸÑÿ®ŸàÿßŸÇŸä',prix:800},{fr:'BATNA',ar:'ÿ®ÿßÿ™ŸÜÿ©',prix:800},{fr:'BEJAIA',ar:'ÿ®ÿ¨ÿßŸäÿ©',prix:450},{fr:'BISKRA',ar:'ÿ®ÿ≥ŸÉÿ±ÿ©',prix:950},{fr:'BECHAR',ar:'ÿ®ÿ¥ÿßÿ±',prix:1100},{fr:'BLIDA',ar:'ÿßŸÑÿ®ŸÑŸäÿØÿ©',prix:750},{fr:'BOUIRA',ar:'ÿßŸÑÿ®ŸàŸäÿ±ÿ©',prix:700},{fr:'TAMANRASSET',ar:'ÿ™ŸÖŸÜÿ±ÿßÿ≥ÿ™',prix:1600},{fr:'TEBESSA',ar:'ÿ™ÿ®ÿ≥ÿ©',prix:800},{fr:'TLEMCEN',ar:'ÿ™ŸÑŸÖÿ≥ÿßŸÜ',prix:900},{fr:'TIARET',ar:'ÿ™Ÿäÿßÿ±ÿ™',prix:800},{fr:'TIZI OUZOU',ar:'ÿ™Ÿäÿ≤Ÿä Ÿàÿ≤Ÿà',prix:650},{fr:'ALGER',ar:'ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±',prix:600},{fr:'DJELFA',ar:'ÿßŸÑÿ¨ŸÑŸÅÿ©',prix:950},{fr:'JUEL',ar:'ÿ¨Ÿäÿ¨ŸÑ',prix:700},{fr:'SETIF',ar:'ÿ≥ÿ∑ŸäŸÅ',prix:750},{fr:'SAIDA',ar:'ÿ≥ÿπŸäÿØÿ©',prix:800},{fr:'SKIKDA',ar:'ÿ≥ŸÉŸäŸÉÿØÿ©',prix:750},{fr:'SIDIBELABBES',ar:'ÿ≥ŸäÿØŸä ÿ®ŸÑÿπÿ®ÿßÿ≥',prix:750},{fr:'ANNABA',ar:'ÿπŸÜÿßÿ®ÿ©',prix:800},{fr:'GUELMA',ar:'ŸÇÿßŸÑŸÖÿ©',prix:800},{fr:'CONSTANTINE',ar:'ŸÇÿ≥ŸÜÿ∑ŸäŸÜÿ©',prix:750},{fr:'MEDEA',ar:'ÿßŸÑŸÖÿØŸäÿ©',prix:750},{fr:'MOSTAGANEM',ar:'ŸÖÿπÿ≥ŸÉÿ±',prix:750},{fr:'M\'SILA',ar:'ÿßŸÑŸÖÿ≥ŸäŸÑÿ©',prix:850},{fr:'MASCARA',ar:'ŸÖascara',prix:750},{fr:'OUARGLA',ar:'Ÿàÿ±ŸÇŸÑÿ©',prix:1000},{fr:'ORAN',ar:'ŸàŸáÿ±ÿßŸÜ',prix:700},{fr:'EL BAYADH',ar:'ÿßŸÑÿ®Ÿäÿ∂',prix:1050},{fr:'ILLIZI',ar:'ÿ•ŸäŸÑŸäÿ≤Ÿä',prix:1100},{fr:'BORDJ BOU ARRERIDJ',ar:'ÿ®ÿ±ÿ¨ ÿ®Ÿàÿπÿ±Ÿäÿ±Ÿäÿ¨',prix:750},{fr:'BOUMERDES',ar:'ÿ®ŸàŸÖÿ±ÿØÿßÿ≥',prix:750},{fr:'EL TARF',ar:'ÿßŸÑÿ∑ÿßÿ±ŸÅ',prix:850},{fr:'TINDOUF',ar:'ÿ™ŸÜÿØŸàŸÅ',prix:1600},{fr:'TISSEMSILT',ar:'ÿ™Ÿäÿ≥ŸÖÿ≥ŸäŸÑÿ™',prix:800},{fr:'EL OUED',ar:'ÿßŸÑŸàÿßÿØŸä',prix:1000},{fr:'KHENCHELA',ar:'ÿÆŸÜÿ¥ŸÑÿ©',prix:800},{fr:'SOUK AHRAS',ar:'ÿ≥ŸàŸÇ ÿ£Ÿáÿ±ÿßÿ≥',prix:800},{fr:'TIPAZA',ar:'ÿ™Ÿäÿ®ÿßÿ≤ÿ©',prix:900},{fr:'MILA',ar:'ŸÖŸäŸÑÿ©',prix:800},{fr:'AIN DEFLA',ar:'ÿπŸäŸÜ ÿßŸÑÿØŸÅŸÑŸâ',prix:850},{fr:'NAAMA',ar:'ÿßŸÑŸÜÿπÿßŸÖÿ©',prix:800},{fr:'AIN TEMOUCHENT',ar:'ÿπŸäŸÜ ÿ™ŸÖŸàÿ¥ŸÜÿ™',prix:800},{fr:'GHARDAIA',ar:'ÿ∫ÿ±ÿØÿßŸäÿ©',prix:800},{fr:'RELIZANE',ar:'ÿ∫ŸÑŸäÿ≤ÿßŸÜ',prix:800},{fr:'TIMIMOUN',ar:'ÿ™ŸäŸÖŸäŸÖŸàŸÜ',prix:800},{fr:'BORDJ BADJI MOKHTAR',ar:'ÿ®ÿ±ÿ¨ ÿ®ÿßÿ¨Ÿä ŸÖÿÆÿ™ÿßÿ±',prix:800},{fr:'OULED DJELLAL',ar:'ÿ£ŸàŸÑÿßÿØ ÿ¨ŸÑÿßŸÑ',prix:800},{fr:'BENI ABBES',ar:'ÿ®ŸÜŸä ÿπÿ®ÿßÿ≥',prix:800},{fr:'IN SALAH',ar:'ÿπŸäŸÜ ÿµÿßŸÑÿ≠',prix:800},{fr:'IN GUEZZAM',ar:'ÿπŸäŸÜ ŸÇÿ≤ÿßŸÖ',prix:800},{fr:'TOUGGOURT',ar:'ÿ™ŸÇÿ±ÿ™',prix:800},{fr:'DJANET',ar:'ÿ¨ÿßŸÜÿ™',prix:800},{fr:'MGHAIR',ar:'ÿßŸÑÿßÿ∫Ÿàÿßÿ∑',prix:800},{fr:'EL MENIAA',ar:'ÿßŸÑŸÖŸÜŸäÿπÿ©',prix:800}
    ];
    let lang = 'fr';
    const body = document.body;
    const txt = {
      fr:{h1:'Techno Directe',btnLang:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',modalTitle:'Formulaire de commande',placeholderNom:'Nom',placeholderPrenom:'Pr√©nom',placeholderTel1:'T√©l√©phone 1',placeholderTel2:'T√©l√©phone 2 (facultatif)',radioBureau:'Bureau de poste',radioDomicile:'√Ä domicile',submit:'Envoyer la commande',labelWilaya:'Wilaya de livraison :',commanderWhatsapp:'Commander sur WhatsApp',commanderForm:'Commander ici',total:'Total :',adminTitle:'Zone Admin ‚Äì Commandes formulaire',addAffiche:'+ Ajouter une affiche (max 20)',save:'Sauvegarder les changements'},
      ar:{h1:'ÿ™ŸÉŸÜŸà ÿØÿßŸäÿ±ŸÉÿ™',btnLang:'Fran√ßais',modalTitle:'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∑ŸÑÿ®',placeholderNom:'ÿßŸÑŸÑŸÇÿ®',placeholderPrenom:'ÿßŸÑÿßÿ≥ŸÖ',placeholderTel1:'ÿßŸÑŸáÿßÿ™ŸÅ 1',placeholderTel2:'ÿßŸÑŸáÿßÿ™ŸÅ 2 (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)',radioBureau:'ŸÖŸÉÿ™ÿ® ÿßŸÑÿ®ÿ±ŸäÿØ',radioDomicile:'ÿ™ŸàÿµŸäŸÑ ŸÑŸÑŸÖŸÜÿ≤ŸÑ',submit:'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®',labelWilaya:'ŸàŸÑÿßŸäÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ :',commanderWhatsapp:'ÿßÿ∑ŸÑÿ® ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®',commanderForm:'ÿßÿ∑ŸÑÿ® ŸáŸÜÿß',total:'ÿßŸÑŸÖÿ¨ŸÖŸàÿπ :',adminTitle:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ£ÿØŸÖŸÜ ‚Äì ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨',addAffiche:'+ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÑÿµŸÇ (max 20)',save:'ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™'}
    };
    const DEFAULT_CATALOG = [
      {id:1, name:'HP EliteBook 840 G5',desc:'Intel Core i5-8250U ‚Ä¢ 8 Go DDR4 ‚Ä¢ SSD 256 Go ‚Ä¢ 14‚Ä≥ Full HD',price:50000,img:'https://images.unsplash.com/photo-1593640408182-31c70c8268f5?auto=format&fit=crop&w=800&q=60 '},
      {id:2, name:'Lenovo ThinkPad T480',desc:'Intel Core i7-8650U ‚Ä¢ 16 Go DDR4 ‚Ä¢ SSD 512 Go ‚Ä¢ 14‚Ä≥ Full HD',price:72000,img:'https://images.unsplash.com/photo/1541807084-5c52b6b3adef?auto=format&fit=crop&w=800&q=60 '},
      {id:3, name:'MacBook Air 2018',desc:'Intel Core i5 ‚Ä¢ 8 Go ‚Ä¢ SSD 256 Go ‚Ä¢ 13,3‚Ä≥ Retina',price:94000,img:'https://images.unsplash.com/photo/1629131726692-1accd0c53ce0?auto=format&fit=crop&w=800&q=60 '}
    ];
    let catalogue = [];

    initCatalog();
    renderCatalog();
    attachEvents();
    updateLang();
    showCommandes();

    function initCatalog(){
      const saved = localStorage.getItem('technoCatalog');
      if (saved) catalogue = JSON.parse(saved);
      else { catalogue = JSON.parse(JSON.stringify(DEFAULT_CATALOG)); saveCatalog(); }
    }
    function saveCatalog(){
      localStorage.setItem('technoCatalog', JSON.stringify(catalogue));
    }
    function renderCatalog(){
      const cont = document.getElementById('catalogue');
      cont.innerHTML = '';
      catalogue.forEach(prod=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${prod.img}" alt="${prod.name}">
          <div class="info">
            <h2>${prod.name}</h2>
            <p>${prod.desc}</p>
            <p class="price prix-produit" data-prix="${prod.price}">${prod.price.toLocaleString('fr-DZ')} DA</p>
            <label class="label-wilaya">${txt[lang].labelWilaya}
              <select class="wilaya" required></select>
            </label>
            <p class="total"><strong>${txt[lang].total} <span class="montant">${prod.price.toLocaleString('fr-DZ')} DA</span></strong></p>
            <a class="btn whatsapp" href="#">${txt[lang].commanderWhatsapp}</a>
            <button class="btn formulaire" data-id="${prod.id}">${txt[lang].commanderForm}</button>
          </div>`;
        cont.appendChild(card);
      });
      fillWilayaSelects();
      attachCardEvents();
    }
    function fillWilayaSelects(){
      document.querySelectorAll('.wilaya').forEach(sel=>{
        sel.innerHTML = '<option value="">-- '+ (lang==='fr'?'Choisir':'ÿßÿÆÿ™ÿ±') +' --</option>';
        WILAYAS.forEach(w=>{
          const opt = document.createElement('option');
          opt.value = w.prix;
          opt.textContent = lang==='fr'? w.fr : w.ar;
          opt.dataset.nom = w.fr;
          sel.appendChild(opt);
        });
      });
    }
    function attachCardEvents(){
      document.querySelectorAll('.card').forEach(card=>{
        const prix = parseInt(card.querySelector('.prix-produit').dataset.prix);
        const sel = card.querySelector('.wilaya');
        const mont = card.querySelector('.montant');
        const whats = card.querySelector('.whatsapp');
        function upd(){
          const liv = parseInt(sel.value)||0; const tot = prix + liv;
          mont.textContent = tot.toLocaleString('fr-DZ') + ' DA';
          const prodName = card.querySelector('h2').textContent;
          const wtxt = lang==='fr'?
            `Bonjour Techno Directe, je veux commander : ${prodName} (Total : ${tot} DA)`:
            `ŸÖÿ±ÿ≠ÿ®ÿß ÿ™ŸÉŸÜŸà ÿØÿßŸäÿ±ŸÉÿ™ÿå ÿ£ÿ±ŸäÿØ ÿ∑ŸÑÿ® : ${prodName} (ÿßŸÑŸÖÿ¨ŸÖŸàÿπ : ${tot} ÿØÿ¨)`;
          whats.href = `https://wa.me/ ${PHONE1}?text=${encodeURIComponent(wtxt)}`;
        }
        sel.onchange = upd; upd();
      });
    }
    function attachEvents(){
      document.getElementById('langBtn').onclick = ()=>{ lang = lang==='fr'?'ar':'fr'; updateLang(); fillWilayaSelects(); renderCatalog(); };
      document.getElementById('zoneDblClick').ondblclick = ()=>{ document.getElementById('passModal').style.display = 'flex'; };
      document.getElementById('addAffiches').onclick = ()=>{ addEmptyAffiche(); };
      // boutons formulaire
      document.addEventListener('click', e=>{
        if (e.target && e.target.classList.contains('formulaire')){
          const prodId = e.target.dataset.id;
          const prod = catalogue.find(p=>p.id==prodId);
          openFormModal(prod);
        }
      });
    }
    function updateLang(){
      body.dir = lang==='ar'?'rtl':'ltr';
      body.lang = lang;
      document.getElementById('h1-title').textContent = txt[lang].h1;
      document.getElementById('langBtn').textContent = txt[lang].btnLang;
      document.getElementById('addAffiches').textContent = txt[lang].addAffiche;
    }
    function closePassModal(){
      document.getElementById('passModal').style.display = 'none';
      document.getElementById('passInput').value = '';
    }
    function checkPass(){
      if (document.getElementById('passInput').value === PASSWORD){
        closePassModal();
        openAdminPanel();
      } else {
        alert('Mot de passe incorrect');
      }
    }
    function openAdminPanel(){
      document.getElementById('adminPanel').style.display = 'block';
      renderAdminList();
      showCommandes();
    }
    function renderAdminList(){
      const list = document.getElementById('adminList');
      list.innerHTML = '';
      catalogue.forEach((prod,idx)=>{
        const div = document.createElement('div');
        div.className = 'admin-item';
        div.innerHTML = `
          <h4>Affiche ${idx+1}</h4>
          <input type="text" placeholder="Nom" value="${prod.name}" onchange="catalogue[${idx}].name=this.value; saveCatalog();">
          <input type="text" placeholder="Description" value="${prod.desc}" onchange="catalogue[${idx}].desc=this.value; saveCatalog();">
          <input type="number" placeholder="Prix" value="${prod.price}" onchange="catalogue[${idx}].price=parseInt(this.value)||0; saveCatalog();">
          <input type="file" accept="image/*" onchange="changeImage(${idx},this)">
          <img src="${prod.img}" style="max-width:120px;display:block;margin:.3rem 0;">
          <button class="btn" onclick="removeAffiche(${idx})">Supprimer</button>
        `;
        list.appendChild(div);
      });
    }
    function changeImage(idx,input){
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e=>{
        catalogue[idx].img = e.target.result;
        renderAdminList();
        saveCatalog();
      };
      reader.readAsDataURL(file);
    }
    function removeAffiche(idx){
      if (catalogue.length <= 1) return alert('Il faut au moins 1 affiche');
      catalogue.splice(idx,1);
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function addEmptyAffiche(){
      if (catalogue.length >= MAX_AFFICHES) return alert('Max 20 affiches');
      const newId = catalogue.length ? Math.max(...catalogue.map(p=>p.id)) + 1 : 1;
      catalogue.push({id:newId, name:'Nouveau PC',desc:'Description ici',price:50000,img:'https://via.placeholder.com/800x600?text=Nouveau+PC '});
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function openFormModal(prod){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <h2>${txt[lang].modalTitle}</h2>
          <form id="commandeForm">
            <input type="text" name="nom" placeholder="${txt[lang].placeholderNom}" required>
            <input type="text" name="prenom" placeholder="${txt[lang].placeholderPrenom}" required>
            <select name="wilaya" required></select>
            <input type="tel" name="tel1" placeholder="${txt[lang].placeholderTel1}" required>
            <input type="tel" name="tel2" placeholder="${txt[lang].placeholderTel2}">
            <label><input type="radio" name="livraison" value="bureau" checked> ${txt[lang].radioBureau}</label>
            <label><input type="radio" name="livraison" value="domicile"> ${txt[lang].radioDomicile}</label>
            <input type="hidden" name="produit" value="${prod.name}">
            <input type="hidden" name="total">
            <button type="submit" class="btn">${txt[lang].submit}</button>
          </form>
        </div>`;
      document.body.appendChild(overlay);
      const wilSel = overlay.querySelector('select[name=wilaya]');
      wilSel.innerHTML = '<option value="">-- '+ (lang==='fr'?'Choisir':'ÿßÿÆÿ™ÿ±') +' --</option>';
      WILAYAS.forEach(w=>{
        const opt = document.createElement('option');
        opt.value = w.prix;
        opt.textContent = lang==='fr'? w.fr : w.ar;
        opt.dataset.nom = w.fr;
        wilSel.appendChild(opt);
      });
      const totalInput = overlay.querySelector('input[name=total]');
      function updTotal(){
        const liv = parseInt(wilSel.value)||0; const tot = prod.price + liv;
        totalInput.value = tot;
      }
      wilSel.onchange = updTotal; updTotal();
      overlay.querySelector('#commandeForm').onsubmit = e=>{
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target));
        const selected = wilSel.options[wilSel.selectedIndex];
        data.wilayaNom = selected ? selected.textContent : '';
        data.date = new Date().toLocaleString('fr-DZ');
        saveCommande(data);
        alert(lang==='fr'?'Commande enregistr√©e !':'ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ® !');
        overlay.remove();
        showCommandes();
      };
    }
    function saveCommande(obj){
      let arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      // on ajoute un id unique pour pouvoir supprimer une √† une
      obj.id = Date.now();
      arr.push(obj);
      localStorage.setItem('commandesFormulaire', JSON.stringify(arr));
    }
    function showCommandes(){
      const cont = document.getElementById('commandesList');
      const arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      if (!arr.length) return cont.innerHTML = '<p>Aucune commande</p>';

      // bouton tout s√©lectionner
      let html = '';
      arr.forEach((c,i)=>{
        html += `
          <div class="cmd-line">
            <label>
              <input type="checkbox" class="cmdCheck" data-id="${c.id}">
              <strong>${c.nom} ${c.prenom}</strong> | ${c.wilayaNom} | ${c.tel1} ${c.tel2?'/'+c.tel2:''} | ${c.livraison} | ${c.produit} | ${c.total} DA | ${c.date}
            </label>
            <button onclick="deleteOne(${c.id})" title="Supprimer">‚ùå</button>
          </div>`;
      });
      cont.innerHTML = html;

      // cocher/d√©cocher ¬´ tout s√©lectionner ¬ª
      document.getElementById('selectAll').onchange = e=>{
        document.querySelectorAll('.cmdCheck').forEach(ch=>ch.checked = e.target.checked);
      };
    }
    function deleteOne(id){
      let arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      arr = arr.filter(c=>c.id !== id);
      localStorage.setItem('commandesFormulaire', JSON.stringify(arr));
      showCommandes();
    }
    function deleteSelected(){
      const checks = document.querySelectorAll('.cmdCheck:checked');
      if (!checks.length) return alert('Aucune commande s√©lectionn√©e');
      if (!confirm('Supprimer les commandes s√©lectionn√©es ?')) return;
      let arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      const ids = [...checks].map(ch=>parseInt(ch.dataset.id));
      arr = arr.filter(c=>!ids.includes(c.id));
      localStorage.setItem('commandesFormulaire', JSON.stringify(arr));
      showCommandes();
    }
  </script>
</body>
</html>
<div id="zoneDblClick"></div>
    <h1 id="h1-title">Techno Directe</h1>
    <button class="lang-switch" id="langBtn">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
  </header>

  <div class="container">
    <div class="top-banner">üì¶ Cartable gratuit + garantie</div>
    <div class="free-banner" id="freeBanner" style="display:none;">üöö Livraison gratuite 58 wilaya</div>
    <div id="catalogue"></div>
    <div class="admin-panel" id="adminPanel">
      <h2>Zone Admin</h2>
      <label><input type="checkbox" id="freeDeliveryToggle"> Mode livraison gratuite</label>
      <button class="btn" id="addAffiches">+ Ajouter une affiche (max 20)</button>
      <button class="btn" id="toggleSort">üîí Verrouiller glisser/d√©poser</button><span class="sort-hint" id="sortHint"> (d√©verrouill√©)</span>
      <div id="adminList"></div>
      <button class="btn" onclick="saveCatalog()">Sauvegarder les changements</button>

      <h3 style="margin-top:1.2rem">Commandes re√ßues (formulaire)
        <label style="margin-left:1rem;font-size:.9rem;font-weight:normal;">
          <input type="checkbox" id="selectAll"> Tout s√©lectionner
        </label>
        <button class="btn" onclick="deleteSelected()" style="margin-left:.5rem;">Tout supprimer</button>
      </h3>
      <div id="commandesList"></div>
    </div>
  </div>

  <div class="modal-overlay" id="passModal">
    <div class="modal">
      <button class="close" onclick="closePassModal()">&times;</button>
      <h3>Entrez le mot de passe</h3>
      <input type="password" id="passInput" placeholder="Mot de passe" style="width:100%;padding:.5rem;margin:.7rem 0;">
      <button class="btn" onclick="checkPass()">Valider</button>
    </div>
  </div>

  <footer style="text-align:center;padding:1.5rem;font-size:.85rem;color:#777;">
    Contact : 0699039372 / 0560072059 (WhatsApp / appel)<br>
    <div class="social">Facebook : TECHNO_DIRECT | Instagram : TECHNO_DIRECT</div>
  </footer>

  <script>
    const PASSWORD = 'technoid';
    const MAX_AFFICHES = 20;
    const PHONE1 = '213699039372';
    const PHONE2 = '213560072059';
    const WILAYAS = [
      {fr:'ADRAR',ar:'ÿ£ÿØÿ±ÿßÿ±',prix:1400},{fr:'CHLEF',ar:'ÿßŸÑÿ¥ŸÑŸÅ',prix:800},{fr:'LAGHOUAT',ar:'ÿßŸÑÿ£ÿ∫Ÿàÿßÿ∑',prix:950},{fr:'OUM EL BOUAGHI',ar:'ÿ£ŸÖ ÿßŸÑÿ®ŸàÿßŸÇŸä',prix:800},{fr:'BATNA',ar:'ÿ®ÿßÿ™ŸÜÿ©',prix:800},{fr:'BEJAIA',ar:'ÿ®ÿ¨ÿßŸäÿ©',prix:450},{fr:'BISKRA',ar:'ÿ®ÿ≥ŸÉÿ±ÿ©',prix:950},{fr:'BECHAR',ar:'ÿ®ÿ¥ÿßÿ±',prix:1100},{fr:'BLIDA',ar:'ÿßŸÑÿ®ŸÑŸäÿØÿ©',prix:750},{fr:'BOUIRA',ar:'ÿßŸÑÿ®ŸàŸäÿ±ÿ©',prix:700},{fr:'TAMANRASSET',ar:'ÿ™ŸÖŸÜÿ±ÿßÿ≥ÿ™',prix:1600},{fr:'TEBESSA',ar:'ÿ™ÿ®ÿ≥ÿ©',prix:800},{fr:'TLEMCEN',ar:'ÿ™ŸÑŸÖÿ≥ÿßŸÜ',prix:900},{fr:'TIARET',ar:'ÿ™Ÿäÿßÿ±ÿ™',prix:800},{fr:'TIZI OUZOU',ar:'ÿ™Ÿäÿ≤Ÿä Ÿàÿ≤Ÿà',prix:650},{fr:'ALGER',ar:'ÿßŸÑÿ¨ÿ≤ÿßÿ¶ÿ±',prix:600},{fr:'DJELFA',ar:'ÿßŸÑÿ¨ŸÑŸÅÿ©',prix:950},{fr:'JUEL',ar:'ÿ¨Ÿäÿ¨ŸÑ',prix:700},{fr:'SETIF',ar:'ÿ≥ÿ∑ŸäŸÅ',prix:750},{fr:'SAIDA',ar:'ÿ≥ÿπŸäÿØÿ©',prix:800},{fr:'SKIKDA',ar:'ÿ≥ŸÉŸäŸÉÿØÿ©',prix:750},{fr:'SIDIBELABBES',ar:'ÿ≥ŸäÿØŸä ÿ®ŸÑÿπÿ®ÿßÿ≥',prix:750},{fr:'ANNABA',ar:'ÿπŸÜÿßÿ®ÿ©',prix:800},{fr:'GUELMA',ar:'ŸÇÿßŸÑŸÖÿ©',prix:800},{fr:'CONSTANTINE',ar:'ŸÇÿ≥ŸÜÿ∑ŸäŸÜÿ©',prix:750},{fr:'MEDEA',ar:'ÿßŸÑŸÖÿØŸäÿ©',prix:750},{fr:'MOSTAGANEM',ar:'ŸÖÿπÿ≥ŸÉÿ±',prix:750},{fr:'M\'SILA',ar:'ÿßŸÑŸÖÿ≥ŸäŸÑÿ©',prix:850},{fr:'MASCARA',ar:'ŸÖascara',prix:750},{fr:'OUARGLA',ar:'Ÿàÿ±ŸÇŸÑÿ©',prix:1000},{fr:'ORAN',ar:'ŸàŸáÿ±ÿßŸÜ',prix:700},{fr:'EL BAYADH',ar:'ÿßŸÑÿ®Ÿäÿ∂',prix:1050},{fr:'ILLIZI',ar:'ÿ•ŸäŸÑŸäÿ≤Ÿä',prix:1100},{fr:'BORDJ BOU ARRERIDJ',ar:'ÿ®ÿ±ÿ¨ ÿ®Ÿàÿπÿ±Ÿäÿ±Ÿäÿ¨',prix:750},{fr:'BOUMERDES',ar:'ÿ®ŸàŸÖÿ±ÿØÿßÿ≥',prix:750},{fr:'EL TARF',ar:'ÿßŸÑÿ∑ÿßÿ±ŸÅ',prix:850},{fr:'TINDOUF',ar:'ÿ™ŸÜÿØŸàŸÅ',prix:1600},{fr:'TISSEMSILT',ar:'ÿ™Ÿäÿ≥ŸÖÿ≥ŸäŸÑÿ™',prix:800},{fr:'EL OUED',ar:'ÿßŸÑŸàÿßÿØŸä',prix:1000},{fr:'KHENCHELA',ar:'ÿÆŸÜÿ¥ŸÑÿ©',prix:800},{fr:'SOUK AHRAS',ar:'ÿ≥ŸàŸÇ ÿ£Ÿáÿ±ÿßÿ≥',prix:800},{fr:'TIPAZA',ar:'ÿ™Ÿäÿ®ÿßÿ≤ÿ©',prix:900},{fr:'MILA',ar:'ŸÖŸäŸÑÿ©',prix:800},{fr:'AIN DEFLA',ar:'ÿπŸäŸÜ ÿßŸÑÿØŸÅŸÑŸâ',prix:850},{fr:'NAAMA',ar:'ÿßŸÑŸÜÿπÿßŸÖÿ©',prix:800},{fr:'AIN TEMOUCHENT',ar:'ÿπŸäŸÜ ÿ™ŸÖŸàÿ¥ŸÜÿ™',prix:800},{fr:'GHARDAIA',ar:'ÿ∫ÿ±ÿØÿßŸäÿ©',prix:800},{fr:'RELIZANE',ar:'ÿ∫ŸÑŸäÿ≤ÿßŸÜ',prix:800},{fr:'TIMIMOUN',ar:'ÿ™ŸäŸÖŸäŸÖŸàŸÜ',prix:800},{fr:'BORDJ BADJI MOKHTAR',ar:'ÿ®ÿ±ÿ¨ ÿ®ÿßÿ¨Ÿä ŸÖÿÆÿ™ÿßÿ±',prix:800},{fr:'OULED DJELLAL',ar:'ÿ£ŸàŸÑÿßÿØ ÿ¨ŸÑÿßŸÑ',prix:800},{fr:'BENI ABBES',ar:'ÿ®ŸÜŸä ÿπÿ®ÿßÿ≥',prix:800},{fr:'IN SALAH',ar:'ÿπŸäŸÜ ÿµÿßŸÑÿ≠',prix:800},{fr:'IN GUEZZAM',ar:'ÿπŸäŸÜ ŸÇÿ≤ÿßŸÖ',prix:800},{fr:'TOUGGOURT',ar:'ÿ™ŸÇÿ±ÿ™',prix:800},{fr:'DJANET',ar:'ÿ¨ÿßŸÜÿ™',prix:800},{fr:'MGHAIR',ar:'ÿßŸÑÿßÿ∫Ÿàÿßÿ∑',prix:800},{fr:'EL MENIAA',ar:'ÿßŸÑŸÖŸÜŸäÿπÿ©',prix:800}
    ];
    let lang = 'fr';
    let sortLocked = false;
    const body = document.body;
    const txt = {
      fr:{h1:'Techno Directe',btnLang:'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',modalTitle:'Formulaire de commande',placeholderNom:'Nom',placeholderPrenom:'Pr√©nom',placeholderTel1:'T√©l√©phone 1',placeholderTel2:'T√©l√©phone 2 (facultatif)',radioBureau:'Bureau de poste',radioDomicile:'√Ä domicile',submit:'Envoyer la commande',labelWilaya:'Wilaya de livraison :',commanderWhatsapp:'Commander sur WhatsApp',commanderForm:'Commander ici',total:'Total :',adminTitle:'Zone Admin ‚Äì Commandes formulaire',addAffiche:'+ Ajouter une affiche (max 20)',save:'Sauvegarder les changements'},
      ar:{h1:'ÿ™ŸÉŸÜŸà ÿØÿßŸäÿ±ŸÉÿ™',btnLang:'Fran√ßais',modalTitle:'ŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑÿ∑ŸÑÿ®',placeholderNom:'ÿßŸÑŸÑŸÇÿ®',placeholderPrenom:'ÿßŸÑÿßÿ≥ŸÖ',placeholderTel1:'ÿßŸÑŸáÿßÿ™ŸÅ 1',placeholderTel2:'ÿßŸÑŸáÿßÿ™ŸÅ 2 (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)',radioBureau:'ŸÖŸÉÿ™ÿ® ÿßŸÑÿ®ÿ±ŸäÿØ',radioDomicile:'ÿ™ŸàÿµŸäŸÑ ŸÑŸÑŸÖŸÜÿ≤ŸÑ',submit:'ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®',labelWilaya:'ŸàŸÑÿßŸäÿ© ÿßŸÑÿ™ŸàÿµŸäŸÑ :',commanderWhatsapp:'ÿßÿ∑ŸÑÿ® ÿπÿ®ÿ± Ÿàÿßÿ™ÿ≥ÿßÿ®',commanderForm:'ÿßÿ∑ŸÑÿ® ŸáŸÜÿß',total:'ÿßŸÑŸÖÿ¨ŸÖŸàÿπ :',adminTitle:'ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ£ÿØŸÖŸÜ ‚Äì ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨',addAffiche:'+ ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÑÿµŸÇ (max 20)',save:'ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™'}
    };
    const DEFAULT_CATALOG = [
      {id:1, name:'HP EliteBook 840 G5',desc:'Intel Core i5-8250U ‚Ä¢ 8 Go DDR4 ‚Ä¢ SSD 256 Go ‚Ä¢ 14‚Ä≥ Full HD',price:50000,img:'https://images.unsplash.com/photo-1593640408182-31c70c8268f5?auto=format&fit=crop&w=800&q=60'},
      {id:2, name:'Lenovo ThinkPad T480',desc:'Intel Core i7-8650U ‚Ä¢ 16 Go DDR4 ‚Ä¢ SSD 512 Go ‚Ä¢ 14‚Ä≥ Full HD',price:72000,img:'https://images.unsplash.com/photo/1541807084-5c52b6b3adef?auto=format&fit=crop&w=800&q=60'},
      {id:3, name:'MacBook Air 2018',desc:'Intel Core i5 ‚Ä¢ 8 Go ‚Ä¢ SSD 256 Go ‚Ä¢ 13,3‚Ä≥ Retina',price:94000,img:'https://images.unsplash.com/photo/1629131726692-1accd0c53ce0?auto=format&fit=crop&w=800&q=60'}
    ];
    let catalogue = [];

    initCatalog();
    renderCatalog();
    attachEvents();
    updateLang();
    showCommandes();

    function initCatalog(){
      const saved = localStorage.getItem('technoCatalog');
      if (saved) catalogue = JSON.parse(saved);
      else { catalogue = JSON.parse(JSON.stringify(DEFAULT_CATALOG)); saveCatalog(); }
    }
    function saveCatalog(){
      localStorage.setItem('technoCatalog', JSON.stringify(catalogue));
    }
    function renderCatalog(){
      const cont = document.getElementById('catalogue');
      cont.innerHTML = '';
      catalogue.forEach((prod, idx)=>{
        const card = document.createElement('div');
        card.className = 'card';
        card.draggable = !sortLocked;
        card.dataset.index = idx;
        card.innerHTML = `
          <img src="${prod.img}" alt="${prod.name}" onclick="openImageModal('${prod.img}')">
          <div class="info">
            <h2>${prod.name}</h2>
            <p>${prod.desc}</p>
            <p class="price prix-produit" data-prix="${prod.price}">${prod.price.toLocaleString('fr-DZ')} DA</p>
            <label class="label-wilaya">${txt[lang].labelWilaya}
              <select class="wilaya" required></select>
            </label>
            <p class="total"><strong>${txt[lang].total} <span class="montant">${prod.price.toLocaleString('fr-DZ')} DA</span></strong></p>
            <a class="btn whatsapp" href="#">${txt[lang].commanderWhatsapp}</a>
            <button class="btn formulaire" data-id="${prod.id}">${txt[lang].commanderForm}</button>
          </div>`;
        cont.appendChild(card);
      });
      fillWilayaSelects();
      attachCardEvents();
      attachDragEvents();
    }
    function fillWilayaSelects(){
      document.querySelectorAll('.wilaya').forEach(sel=>{
        sel.innerHTML = '<option value="">-- '+ (lang==='fr'?'Choisir':'ÿßÿÆÿ™ÿ±') +' --</option>';
        WILAYAS.forEach(w=>{
          const opt = document.createElement('option');
          opt.value = document.getElementById('freeDeliveryToggle').checked ? 0 : w.prix;
          opt.textContent = lang==='fr'? w.fr : w.ar;
          opt.dataset.nom = w.fr;
          sel.appendChild(opt);
        });
      });
    }
    function attachCardEvents(){
      document.querySelectorAll('.card').forEach(card=>{
        const prix = parseInt(card.querySelector('.prix-produit').dataset.prix);
        const sel = card.querySelector('.wilaya');
        const mont = card.querySelector('.montant');
        const whats = card.querySelector('.whatsapp');
        function upd(){
          const liv = parseInt(sel.value)||0; const tot = prix + liv;
          mont.textContent = tot.toLocaleString('fr-DZ') + ' DA';
          const prodName = card.querySelector('h2').textContent;
          const wtxt = lang==='fr'?
            `Bonjour Techno Directe, je veux commander : ${prodName} (Total : ${tot} DA)`:
            `ŸÖÿ±ÿ≠ÿ®ÿß ÿ™ŸÉŸÜŸà ÿØÿßŸäÿ±ŸÉÿ™ÿå ÿ£ÿ±ŸäÿØ ÿ∑ŸÑÿ® : ${prodName} (ÿßŸÑŸÖÿ¨ŸÖŸàÿπ : ${tot} ÿØÿ¨)`;
          whats.href = `https://wa.me/${PHONE1}?text=${encodeURIComponent(wtxt)}`;
        }
        sel.onchange = upd; upd();
      });
    }
    function attachDragEvents(){
      const cards = document.querySelectorAll('.card');
      cards.forEach(card=>{
        card.ondragstart = e=>{
          if(sortLocked) return false;
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', e.target.dataset.index);
          e.target.classList.add('dragging');
        };
        card.ondragend = e=>e.target.classList.remove('dragging');
        card.ondragover = e=>{
          if(sortLocked) return false;
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          const afterElement = getDragAfterElement(document.getElementById('catalogue'), e.clientY);
          if(afterElement==null) document.getElementById('catalogue').appendChild(dragging);
          else document.getElementById('catalogue').insertBefore(dragging, afterElement);
        };
      });
    }
    function getDragAfterElement(container, y){
      const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
      return draggableElements.reduce((closest, child)=>{
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height/2;
        if(offset<0 && offset>closest.offset) return {offset:offset, element:child};
        else return closest;
      }, {offset:Number.NEGATIVE_INFINITY}).element;
    }
    function attachEvents(){
      document.getElementById('langBtn').onclick = ()=>{ lang = lang==='fr'?'ar':'fr'; updateLang(); fillWilayaSelects(); renderCatalog(); };
      document.getElementById('zoneDblClick').ondblclick = ()=>{ document.getElementById('passModal').style.display = 'flex'; };
      document.getElementById('addAffiches').onclick = ()=>{ addEmptyAffiche(); };
      document.getElementById('toggleSort').onclick = ()=>{ sortLocked = !sortLocked; document.getElementById('toggleSort').textContent = sortLocked ? 'üîì D√©verrouiller glisser/d√©poser' : 'üîí Verrouiller glisser/d√©poser'; document.getElementById('sortHint').textContent = sortLocked ? ' (verrouill√©)' : ' (d√©verrouill√©)'; renderCatalog(); };
      document.getElementById('freeDeliveryToggle').onchange = ()=>{ fillWilayaSelects(); attachCardEvents(); document.getElementById('freeBanner').style.display = document.getElementById('freeDeliveryToggle').checked ? 'block' : 'none'; };
      document.addEventListener('click', e=>{
        if (e.target && e.target.classList.contains('formulaire')){
          const prodId = e.target.dataset.id;
          const prod = catalogue.find(p=>p.id==prodId);
          openFormModal(prod);
        }
      });
    }
    function updateLang(){
      body.dir = lang==='fr'?'ltr':'rtl';
      body.lang = lang;
      document.getElementById('h1-title').textContent = txt[lang].h1;
      document.getElementById('langBtn').textContent = txt[lang].btnLang;
      document.getElementById('addAffiches').textContent = txt[lang].addAffiche;
    }
    function closePassModal(){
      document.getElementById('passModal').style.display = 'none';
      document.getElementById('passInput').value = '';
    }
    function checkPass(){
      if (document.getElementById('passInput').value === PASSWORD){
        closePassModal();
        openAdminPanel();
      } else {
        alert('Mot de passe incorrect');
      }
    }
    function openAdminPanel(){
      document.getElementById('adminPanel').style.display = 'block';
      renderAdminList();
      showCommandes();
    }
    function renderAdminList(){
      const list = document.getElementById('adminList');
      list.innerHTML = '';
      catalogue.forEach((prod,idx)=>{
        const div = document.createElement('div');
        div.className = 'admin-item';
        div.innerHTML = `
          <h4>Affiche ${idx+1}</h4>
          <input type="text" placeholder="Nom" value="${prod.name}" onchange="catalogue[${idx}].name=this.value; saveCatalog();">
          <input type="text" placeholder="Description" value="${prod.desc}" onchange="catalogue[${idx}].desc=this.value; saveCatalog();">
          <input type="number" placeholder="Prix" value="${prod.price}" onchange="catalogue[${idx}].price=parseInt(this.value)||0; saveCatalog();">
          <input type="file" accept="image/*" onchange="changeImage(${idx},this)">
          <img src="${prod.img}" style="max-width:120px;display:block;margin:.3rem 0;">
          <button class="btn" onclick="removeAffiche(${idx})">Supprimer</button>
        `;
        list.appendChild(div);
      });
    }
    function changeImage(idx,input){
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e=>{
        catalogue[idx].img = e.target.result;
        renderAdminList();
        saveCatalog();
      };
      reader.readAsDataURL(file);
    }
    function removeAffiche(idx){
      if (catalogue.length <= 1) return alert('Il faut au moins 1 affiche');
      catalogue.splice(idx,1);
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function addEmptyAffiche(){
      if (catalogue.length >= MAX_AFFICHES) return alert('Max 20 affiches');
      const newId = catalogue.length ? Math.max(...catalogue.map(p=>p.id)) + 1 : 1;
      catalogue.push({id:newId, name:'Nouveau PC',desc:'Description ici',price:50000,img:'https://via.placeholder.com/800x600?text=Nouveau+PC'});
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function openImageModal(src){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <img src="${src}" style="width:100%;border-radius:6px;">
        </div>`;
      document.body.appendChild(overlay);
    }
    function openFormModal(prod){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <h2>${txt[lang].modalTitle}</h2>
          <form id="commandeForm">
            <input type="text" name="nom" placeholder="${txt[lang].placeholderNom}" required>
            <input type="text" name="prenom" placeholder="${txt[lang].placeholderPrenom}" required>
            <select name="wilaya" required></select>
            <input type="tel" name="tel1" placeholder="${txt[lang].placeholderTel1}" required>
            <input type="tel" name="tel2" placeholder="${txt[lang].placeholderTel2}">
            <label><input type="radio" name="livraison" value="bureau" checked> ${txt[lang].radioBureau}</label>
            <label><input type="radio" name="livraison" value="domicile"> ${txt[lang].radioDomicile}</label>
            <input type="hidden" name="produit" value="${prod.name}">
            <input type="hidden" name="total">
            <button type="submit" class="btn">${txt[lang].submit}</button>
          </form>
        </div>`;
      document.body.appendChild(overlay);
      const wilSel = overlay.querySelector('select[name=wilaya]');
      wilSel.innerHTML = '<option value="">-- '+ (lang==='fr'?'Choisir':'ÿßÿÆÿ™ÿ±') +' --</option>';
      WILAYAS.forEach(w=>{
        const opt = document.createElement('option');
        opt.value = document.getElementById('freeDeliveryToggle').checked ? 0 : w.prix;
        opt.textContent = lang==='fr'? w.fr : w.ar;
        opt.dataset.nom = w.fr;
        wilSel.appendChild(opt);
      });
      const totalInput = overlay.querySelector('input[name=          mont.textContent = tot.toLocaleString('fr-DZ') + ' DA';
          const prodName = card.querySelector('h2').textContent;
          const wtxt = lang==='fr'?
            `Bonjour Techno Directe, je veux commander : ${prodName} (Total : ${tot} DA)`:
            `ŸÖÿ±ÿ≠ÿ®ÿß ÿ™ŸÉŸÜŸà ÿØÿßŸäÿ±ŸÉÿ™ÿå ÿ£ÿ±ŸäÿØ ÿ∑ŸÑÿ® : ${prodName} (ÿßŸÑŸÖÿ¨ŸÖŸàÿπ : ${tot} ÿØÿ¨)`;
          whats.href = `https://wa.me/${PHONE1}?text=${encodeURIComponent(wtxt)}`;
        }
        sel.onchange = upd; upd();
      });
    }
    function attachDragEvents(){
      const cards = document.querySelectorAll('.card');
      cards.forEach(card=>{
        card.ondragstart = e=>{
          if(sortLocked) return false;
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/html', e.target.dataset.index);
          e.target.classList.add('dragging');
        };
        card.ondragend = e=>e.target.classList.remove('dragging');
        card.ondragover = e=>{
          if(sortLocked) return false;
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          const afterElement = getDragAfterElement(document.getElementById('catalogue'), e.clientY);
          if(afterElement==null) document.getElementById('catalogue').appendChild(dragging);
          else document.getElementById('catalogue').insertBefore(dragging, afterElement);
        };
      });
    }
    function getDragAfterElement(container, y){
      const draggableElements = [...container.querySelectorAll('.card:not(.dragging)')];
      return draggableElements.reduce((closest, child)=>{
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height/2;
        if(offset<0 && offset>closest.offset) return {offset:offset, element:child};
        else return closest;
      }, {offset:Number.NEGATIVE_INFINITY}).element;
    }
    function attachEvents(){
      document.getElementById('langBtn').onclick = ()=>{ lang = lang==='fr'?'ar':'fr'; updateLang(); fillWilayaSelects(); renderCatalog(); };
      document.getElementById('zoneDblClick').ondblclick = ()=>{ document.getElementById('passModal').style.display = 'flex'; };
      document.getElementById('addAffiches').onclick = ()=>{ addEmptyAffiche(); };
      document.getElementById('toggleSort').onclick = ()=>{ sortLocked = !sortLocked; document.getElementById('toggleSort').textContent = sortLocked ? 'üîì D√©verrouiller glisser/d√©poser' : 'üîí Verrouiller glisser/d√©poser'; document.getElementById('sortHint').textContent = sortLocked ? ' (verrouill√©)' : ' (d√©verrouill√©)'; renderCatalog(); };
      document.getElementById('freeDeliveryToggle').onchange = ()=>{ fillWilayaSelects(); attachCardEvents(); document.getElementById('freeBanner').style.display = document.getElementById('freeDeliveryToggle').checked ? 'block' : 'none'; };
      document.addEventListener('click', e=>{
        if (e.target && e.target.classList.contains('formulaire')){
          const prodId = e.target.dataset.id;
          const prod = catalogue.find(p=>p.id==prodId);
          openFormModal(prod);
        }
      });
    }
    function updateLang(){
      body.dir = lang==='fr'?'ltr':'rtl';
      body.lang = lang;
      document.getElementById('h1-title').textContent = txt[lang].h1;
      document.getElementById('langBtn').textContent = txt[lang].btnLang;
      document.getElementById('addAffiches').textContent = txt[lang].addAffiche;
    }
    function closePassModal(){
      document.getElementById('passModal').style.display = 'none';
      document.getElementById('passInput').value = '';
    }
    function checkPass(){
      if (document.getElementById('passInput').value === PASSWORD){
        closePassModal();
        openAdminPanel();
      } else {
        alert('Mot de passe incorrect');
      }
    }
    function openAdminPanel(){
      document.getElementById('adminPanel').style.display = 'block';
      renderAdminList();
      showCommandes();
    }
    function renderAdminList(){
      const list = document.getElementById('adminList');
      list.innerHTML = '';
      catalogue.forEach((prod,idx)=>{
        const div = document.createElement('div');
        div.className = 'admin-item';
        div.innerHTML = `
          <h4>Affiche ${idx+1}</h4>
          <input type="text" placeholder="Nom" value="${prod.name}" onchange="catalogue[${idx}].name=this.value; saveCatalog();">
          <input type="text" placeholder="Description" value="${prod.desc}" onchange="catalogue[${idx}].desc=this.value; saveCatalog();">
          <input type="number" placeholder="Prix" value="${prod.price}" onchange="catalogue[${idx}].price=parseInt(this.value)||0; saveCatalog();">
          <input type="file" accept="image/*" onchange="changeImage(${idx},this)">
          <img src="${prod.img}" style="max-width:120px;display:block;margin:.3rem 0;">
          <button class="btn" onclick="removeAffiche(${idx})">Supprimer</button>
        `;
        list.appendChild(div);
      });
    }
    function changeImage(idx,input){
      const file = input.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e=>{
        catalogue[idx].img = e.target.result;
        renderAdminList();
        saveCatalog();
      };
      reader.readAsDataURL(file);
    }
    function removeAffiche(idx){
      if (catalogue.length <= 1) return alert('Il faut au moins 1 affiche');
      catalogue.splice(idx,1);
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function addEmptyAffiche(){
      if (catalogue.length >= MAX_AFFICHES) return alert('Max 20 affiches');
      const newId = catalogue.length ? Math.max(...catalogue.map(p=>p.id)) + 1 : 1;
      catalogue.push({id:newId, name:'Nouveau PC',desc:'Description ici',price:50000,img:'https://via.placeholder.com/800x600?text=Nouveau+PC'});
      renderAdminList();
      renderCatalog();
      saveCatalog();
    }
    function openImageModal(src){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <img src="${src}" style="width:100%;border-radius:6px;">
        </div>`;
      document.body.appendChild(overlay);
    }
    function openFormModal(prod){
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.style.display = 'flex';
      overlay.innerHTML = `
        <div class="modal">
          <button class="close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
          <h2>${txt[lang].modalTitle}</h2>
          <form id="commandeForm">
            <input type="text" name="nom" placeholder="${txt[lang].placeholderNom}" required>
            <input type="text" name="prenom" placeholder="${txt[lang].placeholderPrenom}" required>
            <select name="wilaya" required></select>
            <input type="tel" name="tel1" placeholder="${txt[lang].placeholderTel1}" required>
            <input type="tel" name="tel2" placeholder="${txt[lang].placeholderTel2}">
            <label><input type="radio" name="livraison" value="bureau" checked> ${txt[lang].radioBureau}</label>
            <label><input type="radio" name="livraison" value="domicile"> ${txt[lang].radioDomicile}</label>
            <input type="hidden" name="produit" value="${prod.name}">
            <input type="hidden" name="total">
            <button type="submit" class="btn">${txt[lang].submit}</button>
          </form>
        </div>`;
      document.body.appendChild(overlay);
      const wilSel = overlay.querySelector('select[name=wilaya]');
      wilSel.innerHTML = '<option value="">-- '+ (lang==='fr'?'Choisir':'ÿßÿÆÿ™ÿ±') +' --</option>';
      WILAYAS.forEach(w=>{
        const opt = document.createElement('option');
        opt.value = document.getElementById('freeDeliveryToggle').checked ? 0 : w.prix;
        opt.textContent = lang==='fr'? w.fr : w.ar;
        opt.dataset.nom = w.fr;
        wilSel.appendChild(opt);
      });
      const totalInput = overlay.querySelector('input[name=total]');
      function updTotal(){
        const liv = parseInt(wilSel.value)||0; const tot = prod.price + liv;
        totalInput.value = tot;
      }
      wilSel.onchange = updTotal; updTotal();
      overlay.querySelector('#commandeForm').onsubmit = e=>{
        e.preventDefault();
        const data = Object.fromEntries(new FormData(e.target));
        const selected = wilSel.options[wilSel.selectedIndex];
        data.wilayaNom = selected ? selected.textContent : '';
        data.date = new Date().toLocaleString('fr-DZ');
        saveCommande(data);
        alert(lang==='fr'?'Commande enregistr√©e !':'ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ® !');
        overlay.remove();
        showCommandes();
      };
    }
    function saveCommande(obj){
      let arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      obj.id = Date.now();
      arr.push(obj);
      localStorage.setItem('commandesFormulaire', JSON.stringify(arr));
    }
    function showCommandes(){
      const cont = document.getElementById('commandesList');
      const arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      if (!arr.length) return cont.innerHTML = '<p>Aucune commande</p>';
      let html = '';
      arr.forEach((c,i)=>{
        html += `
          <div class="cmd-line">
            <label>
              <input type="checkbox" class="cmdCheck" data-id="${c.id}">
              <strong>${c.nom} ${c.prenom}</strong> | ${c.wilayaNom} | ${c.tel1} ${c.tel2?'/'+c.tel2:''} | ${c.livraison} | ${c.produit} | ${c.total} DA | ${c.date}
            </label>
            <button onclick="deleteOne(${c.id})" title="Supprimer">‚ùå</button>
          </div>`;
      });
      cont.innerHTML = html;
      document.getElementById('selectAll').onchange = e=>{
        document.querySelectorAll('.cmdCheck').forEach(ch=>ch.checked = e.target.checked);
      };
    }
    function deleteOne(id){
      let arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      arr = arr.filter(c=>c.id !== id);
      localStorage.setItem('commandesFormulaire', JSON.stringify(arr));
      showCommandes();
    }
    function deleteSelected(){
      const checks = document.querySelectorAll('.cmdCheck:checked');
      if (!checks.length) return alert('Aucune commande s√©lectionn√©e');
      if (!confirm('Supprimer les commandes s√©lectionn√©es ?')) return;
      let arr = JSON.parse(localStorage.getItem('commandesFormulaire')||'[]');
      const ids = [...checks].map(ch=>parseInt(ch.dataset.id));
      arr = arr.filter(c=>!ids.includes(c.id));
      localStorage.setItem('commandesFormulaire', JSON.stringify(arr));
      showCommandes();
    }
  </script>
</body>
</html>
