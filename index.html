<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Affiches PC — Vitrine</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <h1>Vitrine PC</h1>
    <nav>
      <a href="admin.html" class="btn">Admin</a>
    </nav>
  </header>

  <main class="container">
    <section id="gallery" class="grid">
      <!-- Les affiches seront insérées ici par app.js -->
    </section>
  </main>

  <!-- Modal pour visualiser les images en grand -->
  <div id="lightbox" class="lightbox hidden" role="dialog" aria-hidden="true">
    <button id="lb-close" class="lb-close" aria-label="Fermer">✕</button>
    <img id="lb-img" alt="Agrandissement produit" />
  </div>

  <template id="poster-template">
    <article class="poster card">
      <div class="poster-top">
        <img class="poster-main" src="" alt="Photo principale" />
        <div class="thumbs">
          <button class="thumb" data-index="0"><img src="" alt="miniature 1" /></button>
          <button class="thumb" data-index="1"><img src="" alt="miniature 2" /></button>
          <button class="thumb" data-index="2"><img src="" alt="miniature 3" /></button>
        </div>
      </div>
      <div class="poster-body">
        <h2 class="poster-title"></h2>
        <p class="poster-specs"></p>
        <div class="poster-actions">
          <button class="view-btn btn">Voir</button>
        </div>
      </div>
    </article>
  </template>

  <script src="app.js"></script>
</body>
</html>

:root{
  --bg:#f5f6fa;
  --card:#ffffff;
  --accent:#1f6feb;
  --muted:#6b7280;
  --shadow: 0 6px 18px rgba(18, 18, 18, 0.08);
  --radius:12px;
  --gap:16px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:#0f172a;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  padding-bottom:40px;
}

/* Header */
.site-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:18px 24px;
  background:linear-gradient(90deg,#fff 0%, #fbfdff 100%);
  box-shadow: var(--shadow);
  position:sticky;
  top:0;
  z-index:10;
}
.site-header h1{margin:0;font-size:20px}
.site-header .btn{padding:8px 12px;border-radius:10px;background:var(--accent);color:#fff;text-decoration:none;font-weight:600}

/* Container & Grid */
.container{max-width:1140px;margin:28px auto;padding:0 18px}
.grid{
  display:grid;
  gap:var(--gap);
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
}

/* Poster card */
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.poster-top{position:relative}
.poster-main{
  display:block;
  width:100%;
  aspect-ratio: 16/10;
  object-fit:cover;
  background:#eee;
}
.thumbs{
  display:flex;
  gap:8px;
  padding:10px;
  justify-content:center;
  background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent);
}
.thumb{
  border:0;background:transparent;padding:0;border-radius:8px;
  width:64px;height:48px;overflow:hidden;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;
}
.thumb img{width:100%;height:100%;object-fit:cover;display:block;border-radius:6px}

/* Body */
.poster-body{padding:12px 14px}
.poster-title{margin:0 0 6px;font-size:16px}
.poster-specs{margin:0;color:var(--muted);font-size:13px}
.poster-actions{display:flex;justify-content:flex-end;margin-top:10px}
.btn{
  border:0;padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;cursor:pointer;font-weight:600;
}

/* Lightbox */
.lightbox{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(0,0,0,0.6);z-index:1000;padding:20px;
}
.lightbox.hidden{display:none}
.lightbox img{max-width:100%;max-height:85vh;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.lb-close{
  position:absolute;right:22px;top:20px;background:transparent;border:0;color:#fff;font-size:22px;cursor:pointer;
}

/* Responsive tweaks */
@media (max-width:520px){
  .thumb{width:48px;height:36px}
  .poster-specs{font-size:12px}
}

/* app.js
Responsabilités:
- Charger les "posters" depuis localStorage (clé: posters).
- Si aucun poster, charger des exemples (sample).
- Afficher chaque poster avec image principale et 3 miniatures cliquables.
- Cliquer sur miniature = changer l'image principale. Cliquer sur "Voir" ou image = lightbox.
- Fournir export/import simple via console (admin fera l'UI).
*/

// --- Helpers storage ---
const STORAGE_KEY = 'posters_vitrine_v1';

function loadPosters(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return samplePosters();
    const parsed = JSON.parse(raw);
    if(!Array.isArray(parsed)) return samplePosters();
    return parsed;
  }catch(e){
    console.error('Erreur lecture storage', e);
    return samplePosters();
  }
}

function savePosters(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

// --- Sample data si vide (images placeholder) ---
function sampleImageData(color='#ccc', text='PC'){
  // simple SVG data URL placeholder
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='800'><rect width='100%' height='100%' fill='${color}'/><text x='50%' y='50%' font-size='60' fill='#333' dominant-baseline='middle' text-anchor='middle'>${text}</text></svg>`;
  return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
}

function samplePosters(){
  const p = [
    {
      id: genId(),
      title: "Gamer Fury X1",
      specs: "i7 • RTX 4060 • 16GB RAM • SSD 1TB",
      main: sampleImageData('#e6f0ff','Gamer Fury X1'),
      thumbs: [
        sampleImageData('#dbeafe','detail 1'),
        sampleImageData('#c7f9cc','detail 2'),
        sampleImageData('#ffe4e6','detail 3')
      ]
    },
    {
      id: genId(),
      title: "Office Pro S2",
      specs: "i5 • Intel UHD • 8GB RAM • SSD 512GB",
      main: sampleImageData('#fff7e6','Office Pro S2'),
      thumbs: [
        sampleImageData('#fff1b6','detail 1'),
        sampleImageData('#fce7f3','detail 2'),
        sampleImageData('#e8fdf5','detail 3')
      ]
    }
  ];
  savePosters(p);
  return p;
}

function genId(){ return 'p_' + Math.random().toString(36).slice(2,9); }

// --- Render ---
const gallery = document.getElementById('gallery');
const template = document.getElementById('poster-template');
const lightbox = document.getElementById('lightbox');
const lbImg = document.getElementById('lb-img');
const lbClose = document.getElementById('lb-close');

let posters = loadPosters();

function render(){
  gallery.innerHTML = '';
  posters.forEach(p => {
    const node = template.content.cloneNode(true);
    const article = node.querySelector('.poster');
    article.dataset.id = p.id;
    const title = node.querySelector('.poster-title');
    const specs = node.querySelector('.poster-specs');
    const mainImg = node.querySelector('.poster-main');
    const thumbs = node.querySelectorAll('.thumb img');
    const thumbBtns = node.querySelectorAll('.thumb');

    title.textContent = p.title;
    specs.textContent = p.specs || '';
    mainImg.src = p.main || (p.thumbs && p.thumbs[0]) || '';
    mainImg.alt = `${p.title} — image principale`;

    // Assign thumbs (may be less than 3)
    for(let i=0;i<3;i++){
      const imgEl = thumbs[i];
      const btn = thumbBtns[i];
      const src = (p.thumbs && p.thumbs[i]) ? p.thumbs[i] : '';
      if(src){
        imgEl.src = src;
        imgEl.alt = `${p.title} miniature ${i+1}`;
        btn.addEventListener('click', () => {
          // changer l'image principale
          mainImg.src = src;
        });
        // double click on thumb: open lightbox
        btn.addEventListener('dblclick', () => openLightbox(src));
      } else {
        // hide if absent
        btn.style.display = 'none';
      }
    }

    // click sur image principale = open lightbox
    mainImg.addEventListener('click', () => openLightbox(mainImg.src));

    // View button opens lightbox with main
    node.querySelector('.view-btn').addEventListener('click', () => openLightbox(mainImg.src));

    gallery.appendChild(node);
  });
}

function openLightbox(src){
  lbImg.src = src;
  lightbox.classList.remove('hidden');
  lightbox.setAttribute('aria-hidden', 'false');
}
function closeLightbox(){
  lightbox.classList.add('hidden');
  lightbox.setAttribute('aria-hidden', 'true');
  lbImg.src = '';
}
lbClose.addEventListener('click', closeLightbox);
lightbox.addEventListener('click', (e)=>{
  if(e.target === lightbox) closeLightbox();
});
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeLightbox(); });

render();

// Expose for debug (optionnel)
window._posters = posters;
window._savePosters = (arr)=>{ posters = arr; savePosters(arr); render(); };

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Vitrine PC</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* petits ajustements pour admin */
    .admin-wrap{max-width:1000px;margin:24px auto;padding:18px;background:var(--card);border-radius:12px;box-shadow:var(--shadow)}
    form .row{display:flex;gap:12px;flex-wrap:wrap}
    input, textarea{padding:8px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px;width:100%}
    label{font-weight:600;font-size:13px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .list-posters{margin-top:20px}
    .list-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#f9fbff)}
    .list-item img{width:84px;height:60px;object-fit:cover;border-radius:8px}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:13px;padding:6px 8px}
  </style>
</head>
<body>
  <header class="site-header">
    <h1>Admin — Vitrine PC</h1>
    <nav>
      <a href="index.html" class="btn">Voir la vitrine</a>
    </nav>
  </header>

  <main class="container">
    <div class="admin-wrap">
      <h2>Ajouter / Modifier une affiche</h2>
      <form id="poster-form">
        <div>
          <label>Titre</label>
          <input id="title" required />
        </div>
        <div>
          <label>Specs / Description courte</label>
          <input id="specs" />
        </div>

        <div style="margin-top:10px">
          <label>Image principale (fichier)</label>
          <input id="main-file" type="file" accept="image/*" />
        </div>

        <div style="margin-top:10px">
          <label>3 images secondaires (optionnel)</label>
          <input id="thumb-files" type="file" accept="image/*" multiple />
          <p class="muted">Sélectionnez jusqu'à 3 images. Elles seront utilisées comme miniatures cliquables.</p>
        </div>

        <div class="controls">
          <button type="submit" class="btn">Enregistrer</button>
          <button id="clear-storage" type="button" class="btn small" style="background:#ef4444">Supprimer tout</button>
          <button id="export-json" type="button" class="btn small" style="background:#10b981">Exporter JSON</button>
          <label for="import-file" class="btn small" style="background:#f59e0b;cursor:pointer">Importer JSON</label>
          <input id="import-file" type="file" accept="application/json" style="display:none" />
        </div>
      </form>

      <section class="list-posters" id="list-posters">
        <h3>Affiches existantes</h3>
        <!-- Liste remplie par admin.js -->
      </section>
    </div>
  </main>

  <script src="admin.js"></script>
</body>
</html>

/* admin.js
- Partage le même STORAGE_KEY que app.js
- Permet création, édition, suppression, export/import JSON, et suppression totale.
*/

const STORAGE_KEY = 'posters_vitrine_v1';

// Elements
const form = document.getElementById('poster-form');
const titleInput = document.getElementById('title');
const specsInput = document.getElementById('specs');
const mainFile = document.getElementById('main-file');
const thumbFiles = document.getElementById('thumb-files');
const listContainer = document.getElementById('list-posters');
const clearBtn = document.getElementById('clear-storage');
const exportBtn = document.getElementById('export-json');
const importFile = document.getElementById('import-file');

let posters = loadPosters();
let editingId = null;

function loadPosters(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return [];
    const parsed = JSON.parse(raw);
    if(!Array.isArray(parsed)) return [];
    return parsed;
  }catch(e){
    console.error(e);
    return [];
  }
}
function saveAll(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(posters));
  // For convenience, notify app page if open in another tab by using storage event
  renderList();
}

// Utility: read file to dataURL
function fileToDataURL(file){
  return new Promise((res,rej)=>{
    const reader = new FileReader();
    reader.onload = ()=>res(reader.result);
    reader.onerror = ()=>rej(new Error("Erreur lecture fichier"));
    reader.readAsDataURL(file);
  });
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const title = titleInput.value.trim();
  const specs = specsInput.value.trim();
  if(!title){ alert('Titre requis'); return; }

  let mainData = null;
  if(mainFile.files && mainFile.files[0]){
    mainData = await fileToDataURL(mainFile.files[0]);
  }

  const thumbsData = [];
  if(thumbFiles.files && thumbFiles.files.length){
    for(let i=0;i<Math.min(3, thumbFiles.files.length); i++){
      const f = thumbFiles.files[i];
      const d = await fileToDataURL(f);
      thumbsData.push(d);
    }
  }

  if(editingId){
    // Edit existing
    const idx = posters.findIndex(p => p.id === editingId);
    if(idx === -1) { alert('Élément introuvable'); resetForm(); return; }
    if(mainData) posters[idx].main = mainData;
    if(thumbsData.length) posters[idx].thumbs = thumbsData;
    posters[idx].title = title;
    posters[idx].specs = specs;
    editingId = null;
  } else {
    // New
    const newPoster = {
      id: genId(),
      title,
      specs,
      main: mainData || '',
      thumbs: thumbsData
    };
    posters.unshift(newPoster);
  }

  saveAll();
  resetForm();
});

function genId(){ return 'p_' + Math.random().toString(36).slice(2,9); }

function resetForm(){
  form.reset();
  titleInput.value = '';
  specsInput.value = '';
  mainFile.value = '';
  thumbFiles.value = '';
  editingId = null;
}

function renderList(){
  const list = posters.map(p => {
    const mainThumb = p.main || (p.thumbs && p.thumbs[0]) || '';
    return { id: p.id, title: p.title, specs: p.specs, thumb: mainThumb };
  });

  const html = list.length === 0 ? '<p class="muted">Aucune affiche pour l’instant.</p>' : list.map(it => `
    <div class="list-item" data-id="${it.id}">
      <img src="${it.thumb}" alt="${it.title}" />
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>${escapeHtml(it.title)}</strong>
          <div>
            <button class="edit small">Editer</button>
            <button class="delete small" style="background:#ef4444">Suppr</button>
          </div>
        </div>
        <div class="muted">${escapeHtml(it.specs || '')}</div>
      </div>
    </div>
  `).join('');
  listContainer.innerHTML = `<h3>Affiches existantes</h3>${html}`;

  // Add event listeners
  listContainer.querySelectorAll('.edit').forEach(btn=>{
    btn.addEventListener('click', (ev)=>{
      const id = ev.target.closest('.list-item').dataset.id;
      startEdit(id);
    });
  });
  listContainer.querySelectorAll('.delete').forEach(btn=>{
    btn.addEventListener('click', (ev)=>{
      const id = ev.target.closest('.list-item').dataset.id;
      if(confirm('Supprimer cette affiche ?')) {
        posters = posters.filter(p => p.id !== id);
        saveAll();
      }
    });
  });
}

function startEdit(id){
  const p = posters.find(x=>x.id===id);
  if(!p) return alert('Introuvable');
  editingId = id;
  titleInput.value = p.title || '';
  specsInput.value = p.specs || '';
  // note: on ne préremplit pas les inputs file (impossible JS) — l'utilisateur peut choisir de remplacer
  window.scrollTo({top:0,behavior:'smooth'});
}

// Clear all
clearBtn.addEventListener('click', ()=>{
  if(!confirm('Supprimer toutes les affiches ?')) return;
  posters = [];
  saveAll();
});

// Export JSON
exportBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(posters, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'posters_export.json'; document.body.appendChild(a); a.click();
  a.remove(); URL.revokeObjectURL(url);
});

// Import JSON
importFile.addEventListener('change', async (ev)=>{
  const f = ev.target.files[0];
  if(!f) return;
  try{
    const txt = await f.text();
    const parsed = JSON.parse(txt);
    if(!Array.isArray(parsed)) throw new Error('Format invalide (tableau attendu)');
    // validation légère: s'assurer que chaque élément a id + title
    const ok = parsed.every(x => x.id && x.title);
    if(!ok) if(!confirm('Le fichier semble différent. Continuer quand même ?')) return;
    // Préfixer IDs pour éviter collisions? Ici on remplace totalement
    if(confirm('Importer va remplacer les affiches actuelles. Continuer ?')) {
      posters = parsed;
      saveAll();
    }
  }catch(e){
    alert('Erreur import: ' + e.message);
  } finally {
    importFile.value = '';
  }
});

renderList();
